import { useState, useEffect, useCallback, useRef } from "react";
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
import { getDatabase, ref, push, set, get, onValue, remove, child }
  from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";

// â”€â”€â”€ CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const ADMIN_CODE = "TEACHER2024";
const TIMER_SECS = 30;
const API_MODEL = "claude-sonnet-4-20250514";

// â”€â”€â”€ FIREBASE CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// âš ï¸ REPLACE with your Firebase project config from:
//    Firebase Console â†’ Project Settings â†’ General â†’ Your apps â†’ Web config
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  databaseURL: "https://YOUR_PROJECT-default-rtdb.firebaseio.com",
  projectId: "YOUR_PROJECT",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};

const firebaseApp = initializeApp(firebaseConfig);
const fbDatabase = getDatabase(firebaseApp);

// â”€â”€â”€ FIREBASE DB HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const fbDb = {
  /** Push a new score to /scores */
  async pushScore(scoreData) {
    const scoresRef = ref(fbDatabase, "scores");
    const newRef = push(scoresRef);
    await set(newRef, scoreData);
    return newRef.key;
  },
  /** Listen to all scores in real-time; returns unsubscribe fn */
  onScores(callback) {
    const scoresRef = ref(fbDatabase, "scores");
    return onValue(scoresRef, (snapshot) => {
      const data = snapshot.val() || {};
      const list = Object.entries(data).map(([key, val]) => ({ ...val, _fbKey: key }))
        .sort((a, b) => new Date(b.date) - new Date(a.date));
      callback(list);
    });
  },
  /** Listen to scores for a specific member ID */
  onMyScores(memberId, callback) {
    const scoresRef = ref(fbDatabase, "scores");
    return onValue(scoresRef, (snapshot) => {
      const data = snapshot.val() || {};
      const list = Object.entries(data)
        .map(([key, val]) => ({ ...val, _fbKey: key }))
        .filter(s => s.id === memberId)
        .sort((a, b) => new Date(b.date) - new Date(a.date));
      callback(list);
    });
  },
  /** Delete a score by its Firebase key */
  async deleteScore(fbKey) {
    const scoreRef = ref(fbDatabase, "scores/" + fbKey);
    await remove(scoreRef);
  },
};

// â”€â”€â”€ ACCOUNT MANAGEMENT (Firebase) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const accounts = {
  async getAll() {
    const snap = await get(ref(fbDatabase, "accounts"));
    if (!snap.exists()) return [];
    return Object.values(snap.val());
  },
  async getById(id) {
    const snap = await get(ref(fbDatabase, "accounts/" + id.toUpperCase()));
    return snap.exists() ? snap.val() : null;
  },
  async create(id, name) {
    const upperId = id.toUpperCase();
    const existing = await accounts.getById(upperId);
    if (existing) return { ok: false, msg: "ID à¸™à¸µà¹‰à¸¡à¸µà¸­à¸¢à¸¹à¹ˆà¹ƒà¸™à¸£à¸°à¸šà¸šà¹à¸¥à¹‰à¸§" };
    const acctData = { id: upperId, name, createdAt: new Date().toISOString() };
    await set(ref(fbDatabase, "accounts/" + upperId), acctData);
    return { ok: true };
  },
  async remove(id) {
    await remove(ref(fbDatabase, "accounts/" + id.toUpperCase()));
  },
  async validate(id) {
    const acc = await accounts.getById(id.toUpperCase());
    if (!acc) return { ok: false, msg: "à¹„à¸¡à¹ˆà¸à¸š ID à¸™à¸µà¹‰à¹ƒà¸™à¸£à¸°à¸šà¸š â€” à¸à¸£à¸¸à¸“à¸²à¸•à¸´à¸”à¸•à¹ˆà¸­ Admin" };
    return { ok: true, account: acc };
  },
  /** Listen to accounts in real-time */
  onAccounts(callback) {
    return onValue(ref(fbDatabase, "accounts"), (snapshot) => {
      const data = snapshot.val() || {};
      callback(Object.values(data));
    });
  },
};

// â”€â”€â”€ RESPONSIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function useBreakpoint() {
  const [w, setW] = useState(typeof window !== "undefined" ? window.innerWidth : 1200);
  useEffect(() => {
    const fn = () => setW(window.innerWidth);
    window.addEventListener("resize", fn);
    return () => window.removeEventListener("resize", fn);
  }, []);
  return { isMobile: w < 640, isDesktop: w >= 1024 };
}

// â”€â”€â”€ TOPIC CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const TC = {
  "à¸Ÿà¸´à¸ªà¸´à¸à¸ªà¹Œ": { c: "#60a5fa", bg: "rgba(96,165,250,0.1)", bd: "rgba(96,165,250,0.25)", icon: "âš¡" },
  "à¹€à¸„à¸¡à¸µ": { c: "#f472b6", bg: "rgba(244,114,182,0.1)", bd: "rgba(244,114,182,0.25)", icon: "âš—ï¸" },
  "à¸Šà¸µà¸§à¸§à¸´à¸—à¸¢à¸²": { c: "#34d399", bg: "rgba(52,211,153,0.1)", bd: "rgba(52,211,153,0.25)", icon: "ğŸ§¬" },
};

// â”€â”€â”€ GLOSSARY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const GL = {
  "à¸„à¸§à¸²à¸¡à¹€à¸‰à¸·à¹ˆà¸­à¸¢": { en: "Inertia", def: "à¸ªà¸¡à¸šà¸±à¸•à¸´à¸‚à¸­à¸‡à¸§à¸±à¸•à¸–à¸¸à¸—à¸µà¹ˆà¸•à¹‰à¸²à¸™à¸—à¸²à¸™à¸à¸²à¸£à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹à¸›à¸¥à¸‡à¸ªà¸ à¸²à¸à¸à¸²à¸£à¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™à¸—à¸µà¹ˆ", ex: "à¸„à¸™à¹ƒà¸™à¸£à¸–à¸ˆà¸°à¹‚à¸¢à¸à¹„à¸›à¸”à¹‰à¸²à¸™à¸«à¸¥à¸±à¸‡à¹€à¸¡à¸·à¹ˆà¸­à¸£à¸–à¸­à¸­à¸à¸•à¸±à¸§", cat: "à¸Ÿà¸´à¸ªà¸´à¸à¸ªà¹Œ" },
  "à¹‚à¸¡à¹€à¸¡à¸™à¸•à¸±à¸¡": { en: "Momentum", def: "à¸›à¸£à¸´à¸¡à¸²à¸“à¸à¸²à¸£à¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™à¸—à¸µà¹ˆ p = mv (à¸¡à¸§à¸¥ Ã— à¸„à¸§à¸²à¸¡à¹€à¸£à¹‡à¸§)", ex: "à¸£à¸–à¸šà¸£à¸£à¸—à¸¸à¸à¸¡à¸µà¹‚à¸¡à¹€à¸¡à¸™à¸•à¸±à¸¡à¸¡à¸²à¸à¸à¸§à¹ˆà¸²à¸£à¸–à¹€à¸¥à¹‡à¸à¸—à¸µà¹ˆà¸„à¸§à¸²à¸¡à¹€à¸£à¹‡à¸§à¹€à¸—à¹ˆà¸²à¸à¸±à¸™", cat: "à¸Ÿà¸´à¸ªà¸´à¸à¸ªà¹Œ" },
  "à¸à¸¥à¸±à¸‡à¸‡à¸²à¸™à¸ˆà¸¥à¸™à¹Œ": { en: "Kinetic Energy", def: "à¸à¸¥à¸±à¸‡à¸‡à¸²à¸™à¸—à¸µà¹ˆà¸§à¸±à¸•à¸–à¸¸à¸¡à¸µà¹€à¸™à¸·à¹ˆà¸­à¸‡à¸ˆà¸²à¸à¸à¸²à¸£à¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™à¸—à¸µà¹ˆ Ek = Â½mvÂ²", ex: "à¸¥à¸¹à¸à¸šà¸­à¸¥à¸—à¸µà¹ˆà¸§à¸´à¹ˆà¸‡à¸¡à¸µà¸à¸¥à¸±à¸‡à¸‡à¸²à¸™à¸ˆà¸¥à¸™à¹Œ", cat: "à¸Ÿà¸´à¸ªà¸´à¸à¸ªà¹Œ" },
  "à¸à¸¥à¸±à¸‡à¸‡à¸²à¸™à¸¨à¸±à¸à¸¢à¹Œ": { en: "Potential Energy", def: "à¸à¸¥à¸±à¸‡à¸‡à¸²à¸™à¸—à¸µà¹ˆà¸ªà¸°à¸ªà¸¡à¹ƒà¸™à¸§à¸±à¸•à¸–à¸¸à¹€à¸™à¸·à¹ˆà¸­à¸‡à¸ˆà¸²à¸à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡ Ep = mgh", ex: "à¸™à¹‰à¸³à¹ƒà¸™à¹€à¸‚à¸·à¹ˆà¸­à¸™à¸ªà¸¹à¸‡à¸¡à¸µà¸à¸¥à¸±à¸‡à¸‡à¸²à¸™à¸¨à¸±à¸à¸¢à¹Œà¸¡à¸²à¸", cat: "à¸Ÿà¸´à¸ªà¸´à¸à¸ªà¹Œ" },
  "à¹à¸£à¸‡à¸ªà¸¹à¹ˆà¸¨à¸¹à¸™à¸¢à¹Œà¸à¸¥à¸²à¸‡": { en: "Centripetal Force", def: "à¹à¸£à¸‡à¸—à¸µà¹ˆà¸à¸£à¸°à¸—à¸³à¸•à¹ˆà¸­à¸§à¸±à¸•à¸–à¸¸à¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™à¸—à¸µà¹ˆà¹€à¸›à¹‡à¸™à¸§à¸‡à¸à¸¥à¸¡ F = mvÂ²/r", ex: "à¹à¸£à¸‡à¹‚à¸™à¹‰à¸¡à¸–à¹ˆà¸§à¸‡à¸—à¸³à¹ƒà¸«à¹‰à¸”à¸²à¸§à¹€à¸—à¸µà¸¢à¸¡à¹‚à¸„à¸ˆà¸£", cat: "à¸Ÿà¸´à¸ªà¸´à¸à¸ªà¹Œ" },
  "à¸à¸²à¸£à¸«à¸±à¸à¹€à¸«": { en: "Refraction", def: "à¸à¸²à¸£à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸—à¸´à¸¨à¸—à¸²à¸‡à¸‚à¸­à¸‡à¸„à¸¥à¸·à¹ˆà¸™à¹€à¸¡à¸·à¹ˆà¸­à¸œà¹ˆà¸²à¸™à¸•à¸±à¸§à¸à¸¥à¸²à¸‡à¸•à¹ˆà¸²à¸‡à¸Šà¸™à¸´à¸”", ex: "à¸Šà¹‰à¸­à¸™à¹ƒà¸™à¹à¸à¹‰à¸§à¸™à¹‰à¸³à¸”à¸¹à¸«à¸±à¸à¸‡à¸­", cat: "à¸Ÿà¸´à¸ªà¸´à¸à¸ªà¹Œ" },
  "à¸à¸²à¸£à¸ªà¸°à¸—à¹‰à¸­à¸™à¸à¸¥à¸±à¸šà¸«à¸¡à¸”": { en: "Total Internal Reflection", def: "à¹à¸ªà¸‡à¸ªà¸°à¸—à¹‰à¸­à¸™à¸à¸¥à¸±à¸šà¸«à¸¡à¸”à¹€à¸¡à¸·à¹ˆà¸­à¸¡à¸¸à¸¡à¸•à¸à¸à¸£à¸°à¸—à¸šà¸¡à¸²à¸à¸à¸§à¹ˆà¸²à¸¡à¸¸à¸¡à¸§à¸´à¸à¸¤à¸•", ex: "Fiber Optic à¸ªà¹ˆà¸‡à¸ªà¸±à¸à¸à¸²à¸“", cat: "à¸Ÿà¸´à¸ªà¸´à¸à¸ªà¹Œ" },
  "à¹‚à¸Ÿà¹‚à¸•à¸­à¸´à¹€à¸¥à¹‡à¸à¸•à¸£à¸´à¸": { en: "Photoelectric Effect", def: "à¹à¸ªà¸‡à¸à¸£à¸°à¸—à¸šà¹‚à¸¥à¸«à¸°à¸—à¸³à¹ƒà¸«à¹‰à¸­à¸´à¹€à¸¥à¹‡à¸à¸•à¸£à¸­à¸™à¸«à¸¥à¸¸à¸”à¸­à¸­à¸ E = hf", ex: "à¹‚à¸‹à¸¥à¸²à¸£à¹Œà¹€à¸‹à¸¥à¸¥à¹Œà¹à¸›à¸¥à¸‡à¹à¸ªà¸‡à¹€à¸›à¹‡à¸™à¹„à¸Ÿà¸Ÿà¹‰à¸²", cat: "à¸Ÿà¸´à¸ªà¸´à¸à¸ªà¹Œ" },
  "à¸à¸¥à¸±à¸‡à¸‡à¸²à¸™à¸à¸£à¸°à¸•à¸¸à¹‰à¸™": { en: "Activation Energy", def: "à¸à¸¥à¸±à¸‡à¸‡à¸²à¸™à¸‚à¸±à¹‰à¸™à¸•à¹ˆà¸³à¸—à¸µà¹ˆà¸›à¸à¸´à¸à¸´à¸£à¸´à¸¢à¸²à¸•à¹‰à¸­à¸‡à¸à¸²à¸£", ex: "à¹„à¸¡à¹‰à¸‚à¸µà¸”à¸•à¹‰à¸­à¸‡à¹€à¸ªà¸µà¸¢à¸”à¸ªà¸µà¸à¹ˆà¸­à¸™à¸ˆà¸¸à¸”à¸•à¸´à¸”", cat: "à¹€à¸„à¸¡à¸µ" },
  "à¸à¸±à¸™à¸˜à¸°à¹‚à¸„à¸§à¸²à¹€à¸¥à¸™à¸•à¹Œ": { en: "Covalent Bond", def: "à¸­à¸°à¸•à¸­à¸¡ 2 à¸•à¸±à¸§à¹ƒà¸Šà¹‰à¸­à¸´à¹€à¸¥à¹‡à¸à¸•à¸£à¸­à¸™à¸£à¹ˆà¸§à¸¡à¸à¸±à¸™", ex: "Hâ‚‚O à¸¡à¸µà¸à¸±à¸™à¸˜à¸°à¹‚à¸„à¸§à¸²à¹€à¸¥à¸™à¸•à¹Œ", cat: "à¹€à¸„à¸¡à¸µ" },
  "à¸à¸±à¸™à¸˜à¸°à¹„à¸­à¸­à¸­à¸™à¸´à¸": { en: "Ionic Bond", def: "à¹à¸£à¸‡à¸”à¸¶à¸‡à¸”à¸¹à¸”à¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡à¹„à¸­à¸­à¸­à¸™à¸šà¸§à¸à¹à¸¥à¸°à¸¥à¸š", ex: "NaCl: Naâº à¸à¸±à¸š Clâ»", cat: "à¹€à¸„à¸¡à¸µ" },
  "à¹€à¸¥à¸‚à¸­à¸²à¹‚à¸§à¸à¸²à¹‚à¸”à¸£": { en: "Avogadro's Number", def: "à¸ˆà¸³à¸™à¸§à¸™à¸­à¸™à¸¸à¸ à¸²à¸„à¹ƒà¸™ 1 à¹‚à¸¡à¸¥ = 6.022Ã—10Â²Â³", ex: "à¸™à¹‰à¸³ 18g = 1 mol", cat: "à¹€à¸„à¸¡à¸µ" },
  "à¸«à¸¥à¸±à¸à¸à¸²à¸£à¹€à¸¥à¸­à¸Šà¸²à¹€à¸•à¸­à¸¥à¸´à¹€à¸¢à¸£à¹Œ": { en: "Le Chatelier's Principle", def: "à¸£à¸°à¸šà¸šà¸ªà¸¡à¸”à¸¸à¸¥à¸ˆà¸°à¸›à¸£à¸±à¸šà¸•à¸±à¸§à¸•à¹‰à¸²à¸™à¸—à¸²à¸™à¸à¸²à¸£à¸£à¸šà¸à¸§à¸™", ex: "à¹€à¸à¸´à¹ˆà¸¡à¸„à¸§à¸²à¸¡à¸”à¸±à¸™à¹ƒà¸™à¸à¸²à¸£à¸ªà¸±à¸‡à¹€à¸„à¸£à¸²à¸°à¸«à¹Œ NHâ‚ƒ", cat: "à¹€à¸„à¸¡à¸µ" },
  "à¸ªà¸²à¸£à¸¥à¸°à¸¥à¸²à¸¢à¸šà¸±à¸Ÿà¹€à¸Ÿà¸­à¸£à¹Œ": { en: "Buffer Solution", def: "à¸•à¹‰à¸²à¸™à¸—à¸²à¸™à¸à¸²à¸£à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™ pH", ex: "à¹€à¸¥à¸·à¸­à¸”à¸£à¸±à¸à¸©à¸² pH â‰ˆ 7.4", cat: "à¹€à¸„à¸¡à¸µ" },
  "à¸ªà¸°à¸›à¸­à¸™à¸™à¸´à¸Ÿà¸´à¹€à¸„à¸Šà¸±à¸™": { en: "Saponification", def: "à¸›à¸à¸´à¸à¸´à¸£à¸´à¸¢à¸²à¹„à¸‚à¸¡à¸±à¸™ + à¹€à¸šà¸ªà¹à¸à¹ˆ â†’ à¸ªà¸šà¸¹à¹ˆ + à¸à¸¥à¸µà¹€à¸‹à¸­à¸£à¸­à¸¥", ex: "à¸™à¹‰à¸³à¸¡à¸±à¸™à¸¡à¸°à¸à¸£à¹‰à¸²à¸§ + NaOH â†’ à¸ªà¸šà¸¹à¹ˆ", cat: "à¹€à¸„à¸¡à¸µ" },
  "à¸à¸­à¸¥à¸´à¹€à¸¡à¸­à¸£à¹Œ": { en: "Polymer", def: "à¹‚à¸¡à¹€à¸¥à¸à¸¸à¸¥à¹ƒà¸«à¸à¹ˆà¸ˆà¸²à¸à¸«à¸™à¹ˆà¸§à¸¢à¸‹à¹‰à¸³ (à¸¡à¸­à¸™à¸­à¹€à¸¡à¸­à¸£à¹Œ)", ex: "à¸à¸¥à¸²à¸ªà¸•à¸´à¸ à¸¢à¸²à¸‡ à¹„à¸™à¸¥à¸­à¸™", cat: "à¹€à¸„à¸¡à¸µ" },
  "à¹€à¸‹à¸¥à¸¥à¸¹à¹‚à¸¥à¸ª": { en: "Cellulose", def: "à¹‚à¸à¸¥à¸µà¹à¸‹à¹‡à¸à¸„à¸²à¹„à¸£à¸”à¹Œà¸ˆà¸²à¸à¸à¸¥à¸¹à¹‚à¸„à¸ª Î²-1,4 à¹€à¸›à¹‡à¸™à¸œà¸™à¸±à¸‡à¹€à¸‹à¸¥à¸¥à¹Œà¸à¸·à¸Š", ex: "à¸à¹‰à¸²à¸¢ à¸à¸£à¸°à¸”à¸²à¸© à¹à¸¥à¸°à¹„à¸¡à¹‰", cat: "à¸Šà¸µà¸§à¸§à¸´à¸—à¸¢à¸²" },
  "à¹„à¸¡à¹‚à¸•à¸„à¸­à¸™à¹€à¸”à¸£à¸µà¸¢": { en: "Mitochondria", def: "à¸­à¸­à¸£à¹Œà¹à¸à¹€à¸™à¸¥à¸¥à¹Œà¸œà¸¥à¸´à¸• ATP à¸œà¹ˆà¸²à¸™ Oxidative Phosphorylation", ex: "à¸à¸¥à¹‰à¸²à¸¡à¹€à¸™à¸·à¹‰à¸­à¸«à¸±à¸§à¹ƒà¸ˆà¸¡à¸µà¹„à¸¡à¹‚à¸•à¸„à¸­à¸™à¹€à¸”à¸£à¸µà¸¢à¸¡à¸²à¸à¸—à¸µà¹ˆà¸ªà¸¸à¸”", cat: "à¸Šà¸µà¸§à¸§à¸´à¸—à¸¢à¸²" },
  "à¸„à¸¥à¸­à¹‚à¸£à¸à¸¥à¸²à¸ªà¸•à¹Œ": { en: "Chloroplast", def: "à¸­à¸­à¸£à¹Œà¹à¸à¹€à¸™à¸¥à¸¥à¹Œà¸ªà¸±à¸‡à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¹à¸ªà¸‡à¹ƒà¸™à¸à¸·à¸Š", ex: "à¹ƒà¸šà¹„à¸¡à¹‰à¸ªà¸µà¹€à¸‚à¸µà¸¢à¸§à¹€à¸à¸£à¸²à¸°à¸„à¸¥à¸­à¹‚à¸£à¸Ÿà¸´à¸¥à¸¥à¹Œ", cat: "à¸Šà¸µà¸§à¸§à¸´à¸—à¸¢à¸²" },
  "à¹„à¸¡à¹‚à¸—à¸‹à¸´à¸ª": { en: "Mitosis", def: "à¹à¸šà¹ˆà¸‡à¹€à¸‹à¸¥à¸¥à¹Œà¹„à¸”à¹‰à¸¥à¸¹à¸ 2 à¹€à¸‹à¸¥à¸¥à¹Œà¸—à¸µà¹ˆà¸¡à¸µà¹‚à¸„à¸£à¹‚à¸¡à¹‚à¸‹à¸¡ 2n à¹€à¸—à¹ˆà¸²à¹€à¸”à¸´à¸¡", ex: "à¸œà¸´à¸§à¸«à¸™à¸±à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¹€à¸‹à¸¥à¸¥à¹Œà¹ƒà¸«à¸¡à¹ˆ", cat: "à¸Šà¸µà¸§à¸§à¸´à¸—à¸¢à¸²" },
  "à¹„à¸¡à¹‚à¸­à¸‹à¸´à¸ª": { en: "Meiosis", def: "à¹à¸šà¹ˆà¸‡à¹€à¸‹à¸¥à¸¥à¹Œà¹„à¸”à¹‰à¸¥à¸¹à¸ 4 à¹€à¸‹à¸¥à¸¥à¹Œà¸®à¸²à¸à¸¥à¸­à¸¢à¸”à¹Œ (n)", ex: "à¸­à¸ªà¸¸à¸ˆà¸´à¹à¸¥à¸°à¹„à¸‚à¹ˆà¸¡à¸µ 23 à¹‚à¸„à¸£à¹‚à¸¡à¹‚à¸‹à¸¡", cat: "à¸Šà¸µà¸§à¸§à¸´à¸—à¸¢à¸²" },
  "à¸®à¸µà¹‚à¸¡à¹‚à¸à¸¥à¸šà¸´à¸™": { en: "Hemoglobin", def: "à¹‚à¸›à¸£à¸•à¸µà¸™à¹ƒà¸™à¹€à¸¡à¹‡à¸”à¹€à¸¥à¸·à¸­à¸”à¹à¸”à¸‡ à¸¡à¸µ FeÂ²âº à¸ˆà¸±à¸š Oâ‚‚", ex: "à¸—à¸µà¹ˆà¸ªà¸¹à¸‡ Oâ‚‚ à¸™à¹‰à¸­à¸¢ à¸£à¹ˆà¸²à¸‡à¸à¸²à¸¢à¸ªà¸£à¹‰à¸²à¸‡ Hb à¹€à¸à¸´à¹ˆà¸¡", cat: "à¸Šà¸µà¸§à¸§à¸´à¸—à¸¢à¸²" },
  "à¹à¸­à¸™à¸•à¸´à¸šà¸­à¸”à¸µ": { en: "Antibody", def: "à¹‚à¸›à¸£à¸•à¸µà¸™à¸£à¸¹à¸› Y à¸œà¸¥à¸´à¸•à¹‚à¸”à¸¢ B cell à¸ˆà¸±à¸šà¸à¸±à¸šà¹à¸­à¸™à¸•à¸´à¹€à¸ˆà¸™", ex: "à¸§à¸±à¸„à¸‹à¸µà¸™à¸à¸£à¸°à¸•à¸¸à¹‰à¸™à¹ƒà¸«à¹‰à¸ªà¸£à¹‰à¸²à¸‡à¹à¸­à¸™à¸•à¸´à¸šà¸­à¸”à¸µ", cat: "à¸Šà¸µà¸§à¸§à¸´à¸—à¸¢à¸²" },
  "à¸­à¸­à¸ªà¹‚à¸¡à¸‹à¸´à¸ª": { en: "Osmosis", def: "à¸™à¹‰à¸³à¹à¸à¸£à¹ˆà¸œà¹ˆà¸²à¸™à¹€à¸¢à¸·à¹ˆà¸­à¸à¸¶à¹ˆà¸‡à¸‹à¸¶à¸¡à¸ˆà¸²à¸à¹€à¸ˆà¸·à¸­à¸ˆà¸²à¸‡à¹„à¸›à¹€à¸‚à¹‰à¸¡à¸‚à¹‰à¸™", ex: "à¹€à¸‹à¸¥à¸¥à¹Œà¹ƒà¸™à¸™à¹‰à¸³à¹€à¸à¸¥à¸·à¸­à¹€à¸«à¸µà¹ˆà¸¢à¸§", cat: "à¸Šà¸µà¸§à¸§à¸´à¸—à¸¢à¸²" },
  "à¹„à¸à¸¥à¹‚à¸„à¹„à¸¥à¸‹à¸´à¸ª": { en: "Glycolysis", def: "à¸¢à¹ˆà¸­à¸¢à¸à¸¥à¸¹à¹‚à¸„à¸ªà¹ƒà¸™à¹„à¸‹à¹‚à¸—à¸à¸¥à¸²à¸‹à¸¶à¸¡ â†’ à¹„à¸à¸£à¸¹à¹€à¸§à¸• + ATP à¸ªà¸¸à¸—à¸˜à¸´ 2 à¹‚à¸¡à¸¥", ex: "à¸à¸¥à¹‰à¸²à¸¡à¹€à¸™à¸·à¹‰à¸­à¸­à¸­à¸à¹à¸£à¸‡à¸«à¸™à¸±à¸à¹ƒà¸Šà¹‰à¹„à¸à¸¥à¹‚à¸„à¹„à¸¥à¸‹à¸´à¸ª", cat: "à¸Šà¸µà¸§à¸§à¸´à¸—à¸¢à¸²" },
  "à¸à¸²à¸£à¸„à¸±à¸”à¹€à¸¥à¸·à¸­à¸à¹‚à¸”à¸¢à¸˜à¸£à¸£à¸¡à¸Šà¸²à¸•à¸´": { en: "Natural Selection", def: "à¸ªà¸´à¹ˆà¸‡à¸¡à¸µà¸Šà¸µà¸§à¸´à¸•à¸—à¸µà¹ˆà¹€à¸«à¸¡à¸²à¸°à¸ªà¸¡à¸£à¸­à¸”à¹à¸¥à¸°à¸ªà¸·à¸šà¸à¸±à¸™à¸˜à¸¸à¹Œà¹„à¸”à¹‰à¸¡à¸²à¸à¸à¸§à¹ˆà¸²", ex: "à¸¡à¸­à¸”à¸ªà¸µà¹€à¸‚à¹‰à¸¡à¸£à¸­à¸”à¸šà¸™à¸•à¹‰à¸™à¹„à¸¡à¹‰à¸”à¸³", cat: "à¸Šà¸µà¸§à¸§à¸´à¸—à¸¢à¸²" },
};

// â”€â”€â”€ QUESTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const ALL_Q = [
  { q: "à¸à¸à¸‚à¹‰à¸­à¸—à¸µà¹ˆ 1 à¸‚à¸­à¸‡à¸™à¸´à¸§à¸•à¸±à¸™à¸à¸¥à¹ˆà¸²à¸§à¸–à¸¶à¸‡[à¸„à¸§à¸²à¸¡à¹€à¸‰à¸·à¹ˆà¸­à¸¢] à¸«à¸¡à¸²à¸¢à¸„à¸§à¸²à¸¡à¸§à¹ˆà¸²à¸­à¸¢à¹ˆà¸²à¸‡à¹„à¸£?", opts: ["à¸§à¸±à¸•à¸–à¸¸à¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™à¸—à¸µà¹ˆà¹€à¸à¸£à¸²à¸°à¸¡à¸µà¹à¸£à¸‡", "à¸§à¸±à¸•à¸–à¸¸à¸•à¹‰à¸²à¸™à¸à¸²à¸£à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹à¸›à¸¥à¸‡à¸ªà¸ à¸²à¸à¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™à¸—à¸µà¹ˆ", "à¹à¸£à¸‡à¸à¸´à¸£à¸´à¸¢à¸² = à¹à¸£à¸‡à¸›à¸à¸´à¸à¸´à¸£à¸´à¸¢à¸²", "à¸à¸¥à¸±à¸‡à¸‡à¸²à¸™à¸£à¸°à¸šà¸šà¸„à¸‡à¸—à¸µà¹ˆ"], ans: 1, exp: "à¸à¸[à¸„à¸§à¸²à¸¡à¹€à¸‰à¸·à¹ˆà¸­à¸¢]: à¸§à¸±à¸•à¸–à¸¸à¸«à¸¢à¸¸à¸”à¸™à¸´à¹ˆà¸‡à¸ˆà¸°à¸«à¸¢à¸¸à¸”à¸™à¸´à¹ˆà¸‡ à¸–à¹‰à¸²à¹à¸£à¸‡à¸¥à¸±à¸à¸˜à¹Œà¹€à¸›à¹‡à¸™à¸¨à¸¹à¸™à¸¢à¹Œ", topic: "à¸Ÿà¸´à¸ªà¸´à¸à¸ªà¹Œ" },
  { q: "F = ma à¸„à¸·à¸­à¸à¸à¸‚à¹‰à¸­à¸—à¸µà¹ˆà¹€à¸—à¹ˆà¸²à¹„à¸£à¸‚à¸­à¸‡à¸™à¸´à¸§à¸•à¸±à¸™?", opts: ["à¸‚à¹‰à¸­à¸—à¸µà¹ˆ 1", "à¸‚à¹‰à¸­à¸—à¸µà¹ˆ 2", "à¸‚à¹‰à¸­à¸—à¸µà¹ˆ 3", "à¸‚à¹‰à¸­à¸—à¸µà¹ˆ 4"], ans: 1, exp: "à¸à¸à¸‚à¹‰à¸­à¸—à¸µà¹ˆ 2: à¹à¸£à¸‡à¸¥à¸±à¸à¸˜à¹Œ = à¸¡à¸§à¸¥ Ã— à¸„à¸§à¸²à¸¡à¹€à¸£à¹ˆà¸‡ (F = ma)", topic: "à¸Ÿà¸´à¸ªà¸´à¸à¸ªà¹Œ" },
  { q: "[à¸à¸¥à¸±à¸‡à¸‡à¸²à¸™à¸ˆà¸¥à¸™à¹Œ]à¸‚à¸­à¸‡à¸§à¸±à¸•à¸–à¸¸ 2 kg à¸—à¸µà¹ˆà¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™à¸—à¸µà¹ˆ 4 m/s à¸¡à¸µà¸„à¹ˆà¸²à¹€à¸—à¹ˆà¸²à¹ƒà¸”?", opts: ["8 J", "16 J", "32 J", "4 J"], ans: 1, exp: "Ek = Â½mvÂ² = Â½Ã—2Ã—16 = 16 J", topic: "à¸Ÿà¸´à¸ªà¸´à¸à¸ªà¹Œ" },
  { q: "[à¸à¸²à¸£à¸«à¸±à¸à¹€à¸«]à¸‚à¸­à¸‡à¹à¸ªà¸‡à¹€à¸à¸´à¸”à¸‚à¸¶à¹‰à¸™à¹€à¸¡à¸·à¹ˆà¸­à¹ƒà¸”?", opts: ["à¹à¸ªà¸‡à¸à¸£à¸°à¸—à¸šà¸à¸£à¸°à¸ˆà¸", "à¹à¸ªà¸‡à¸œà¹ˆà¸²à¸™à¸ˆà¸²à¸à¸•à¸±à¸§à¸à¸¥à¸²à¸‡à¸«à¸™à¸¶à¹ˆà¸‡à¹„à¸›à¸­à¸µà¸à¸•à¸±à¸§à¸à¸¥à¸²à¸‡", "à¹à¸ªà¸‡à¸œà¹ˆà¸²à¸™à¸£à¸¹à¹€à¸¥à¹‡à¸à¹†", "à¹à¸ªà¸‡à¸ªà¸­à¸‡à¸¥à¸³à¸¡à¸²à¸à¸šà¸à¸±à¸™"], ans: 1, exp: "[à¸à¸²à¸£à¸«à¸±à¸à¹€à¸«]: à¹à¸ªà¸‡à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸•à¸±à¸§à¸à¸¥à¸²à¸‡ â†’ à¸„à¸§à¸²à¸¡à¹€à¸£à¹‡à¸§à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™ â†’ à¸—à¸´à¸¨à¸—à¸²à¸‡à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™", topic: "à¸Ÿà¸´à¸ªà¸´à¸à¸ªà¹Œ" },
  { q: "[à¸à¸²à¸£à¸ªà¸°à¸—à¹‰à¸­à¸™à¸à¸¥à¸±à¸šà¸«à¸¡à¸”]à¹€à¸›à¹‡à¸™à¸«à¸¥à¸±à¸à¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™à¸‚à¸­à¸‡à¸­à¸°à¹„à¸£?", opts: ["à¸à¸¥à¹‰à¸­à¸‡à¹‚à¸—à¸£à¸—à¸£à¸£à¸¨à¸™à¹Œ", "à¹€à¸ªà¹‰à¸™à¹ƒà¸¢à¹à¸à¹‰à¸§à¸™à¸³à¹à¸ªà¸‡ (Fiber Optic)", "à¸à¸¥à¹‰à¸­à¸‡à¸ˆà¸¸à¸¥à¸—à¸£à¸£à¸¨à¸™à¹Œ", "à¹€à¸¥à¹€à¸‹à¸­à¸£à¹Œ"], ans: 1, exp: "[à¸à¸²à¸£à¸ªà¸°à¸—à¹‰à¸­à¸™à¸à¸¥à¸±à¸šà¸«à¸¡à¸”]: à¹à¸ªà¸‡à¹„à¸¡à¹ˆà¸«à¸¥à¸¸à¸”à¸­à¸­à¸à¸ˆà¸²à¸à¹€à¸ªà¹‰à¸™à¹ƒà¸¢à¹à¸à¹‰à¸§", topic: "à¸Ÿà¸´à¸ªà¸´à¸à¸ªà¹Œ" },
  { q: "à¹ƒà¸„à¸£à¹€à¸›à¹‡à¸™à¸œà¸¹à¹‰à¸­à¸˜à¸´à¸šà¸²à¸¢à¸›à¸£à¸²à¸à¸à¸à¸²à¸£à¸“à¹Œ[à¹‚à¸Ÿà¹‚à¸•à¸­à¸´à¹€à¸¥à¹‡à¸à¸•à¸£à¸´à¸]?", opts: ["à¸™à¸´à¸§à¸•à¸±à¸™", "à¹„à¸­à¸™à¹Œà¸ªà¹„à¸•à¸™à¹Œ", "à¸”à¸²à¸£à¹Œà¸§à¸´à¸™", "à¸®à¸­à¸§à¹Œà¸à¸´à¹‰à¸‡"], ans: 1, exp: "à¹„à¸­à¸™à¹Œà¸ªà¹„à¸•à¸™à¹Œà¸­à¸˜à¸´à¸šà¸²à¸¢[à¹‚à¸Ÿà¹‚à¸•à¸­à¸´à¹€à¸¥à¹‡à¸à¸•à¸£à¸´à¸]à¸›à¸µ 1905", topic: "à¸Ÿà¸´à¸ªà¸´à¸à¸ªà¹Œ" },
  { q: "[à¹‚à¸¡à¹€à¸¡à¸™à¸•à¸±à¸¡]à¸­à¸™à¸¸à¸£à¸±à¸à¸©à¹Œà¹€à¸¡à¸·à¹ˆà¸­à¹ƒà¸”?", opts: ["à¹à¸£à¸‡à¸¥à¸±à¸à¸˜à¹Œà¸ à¸²à¸¢à¸™à¸­à¸à¹€à¸›à¹‡à¸™à¸¨à¸¹à¸™à¸¢à¹Œ", "à¸¡à¸µà¹à¸£à¸‡à¹€à¸ªà¸µà¸¢à¸”à¸—à¸²à¸™", "à¸„à¸§à¸²à¸¡à¹€à¸£à¹‡à¸§à¸„à¸‡à¸—à¸µà¹ˆ", "à¸§à¸±à¸•à¸–à¸¸à¸«à¸¢à¸¸à¸”à¸™à¸´à¹ˆà¸‡"], ans: 0, exp: "à¸à¸à¸­à¸™à¸¸à¸£à¸±à¸à¸©à¹Œ[à¹‚à¸¡à¹€à¸¡à¸™à¸•à¸±à¸¡]: à¸–à¹‰à¸²à¹à¸£à¸‡à¸¥à¸±à¸à¸˜à¹Œà¸ à¸²à¸¢à¸™à¸­à¸ = 0", topic: "à¸Ÿà¸´à¸ªà¸´à¸à¸ªà¹Œ" },
  { q: "à¸à¸à¹‚à¸­à¸«à¹Œà¸¡ V = IR à¸–à¹‰à¸² R = 10Î© à¹à¸¥à¸° I = 2A à¹à¸£à¸‡à¸”à¸±à¸™ V à¹€à¸—à¹ˆà¸²à¹ƒà¸”?", opts: ["5 V", "12 V", "20 V", "0.2 V"], ans: 2, exp: "V = IR = 2 Ã— 10 = 20V", topic: "à¸Ÿà¸´à¸ªà¸´à¸à¸ªà¹Œ" },
  { q: "à¸„à¸§à¸²à¸¡à¹€à¸£à¹ˆà¸‡à¹‚à¸™à¹‰à¸¡à¸–à¹ˆà¸§à¸‡à¸—à¸µà¹ˆà¸œà¸´à¸§à¹‚à¸¥à¸à¸¡à¸µà¸„à¹ˆà¸²à¸›à¸£à¸°à¸¡à¸²à¸“à¹€à¸—à¹ˆà¸²à¹ƒà¸”?", opts: ["8.9 m/sÂ²", "9.8 m/sÂ²", "10.8 m/sÂ²", "11.2 m/sÂ²"], ans: 1, exp: "g â‰ˆ 9.8 m/sÂ²", topic: "à¸Ÿà¸´à¸ªà¸´à¸à¸ªà¹Œ" },
  { q: "à¸„à¸¥à¸·à¹ˆà¸™à¹€à¸ªà¸µà¸¢à¸‡à¹€à¸›à¹‡à¸™à¸„à¸¥à¸·à¹ˆà¸™à¸•à¸²à¸¡à¸¢à¸²à¸§à¹€à¸à¸£à¸²à¸°à¸­à¸°à¹„à¸£?", opts: ["à¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™à¸—à¸µà¹ˆà¹„à¸”à¹‰à¹ƒà¸™à¸ªà¸¸à¸à¸à¸²à¸à¸²à¸¨", "à¸­à¸™à¸¸à¸ à¸²à¸„à¸ªà¸±à¹ˆà¸™à¹à¸™à¸§à¹€à¸”à¸µà¸¢à¸§à¸à¸±à¸šà¸—à¸´à¸¨à¸„à¸¥à¸·à¹ˆà¸™", "à¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™à¸—à¸µà¹ˆà¸”à¹‰à¸§à¸¢à¸„à¸§à¸²à¸¡à¹€à¸£à¹‡à¸§à¹à¸ªà¸‡", "à¸¡à¸µà¹à¸­à¸¡à¸à¸¥à¸´à¸ˆà¸¹à¸”à¸„à¸‡à¸—à¸µà¹ˆ"], ans: 1, exp: "à¸„à¸¥à¸·à¹ˆà¸™à¸•à¸²à¸¡à¸¢à¸²à¸§: à¸­à¸™à¸¸à¸ à¸²à¸„à¸ªà¸±à¹ˆà¸™à¸‚à¸™à¸²à¸™à¸à¸±à¸šà¸—à¸´à¸¨à¸à¸²à¸£à¹€à¸”à¸´à¸™à¸—à¸²à¸‡", topic: "à¸Ÿà¸´à¸ªà¸´à¸à¸ªà¹Œ" },
  { q: "à¸£à¸±à¸‡à¸ªà¸µà¹à¸à¸¡à¸¡à¸²à¸•à¹‰à¸­à¸‡à¹ƒà¸Šà¹‰à¸§à¸±à¸ªà¸”à¸¸à¹ƒà¸”à¸à¸±à¹‰à¸™?", opts: ["à¸à¸£à¸°à¸”à¸²à¸©", "à¸­à¸¥à¸¹à¸¡à¸´à¹€à¸™à¸µà¸¢à¸¡", "à¸•à¸°à¸à¸±à¹ˆà¸§à¸«à¸™à¸²à¸«à¸£à¸·à¸­à¸„à¸­à¸™à¸à¸£à¸µà¸•", "à¸™à¹‰à¸³"], ans: 2, exp: "Î±=à¸à¸£à¸°à¸”à¸²à¸©, Î²=à¸­à¸¥à¸¹à¸¡à¸´à¹€à¸™à¸µà¸¢à¸¡, Î³=à¸•à¸°à¸à¸±à¹ˆà¸§à¸«à¸™à¸²", topic: "à¸Ÿà¸´à¸ªà¸´à¸à¸ªà¹Œ" },
  { q: "à¸à¸à¸šà¸­à¸¢à¸¥à¹Œ: à¸—à¸µà¹ˆà¸­à¸¸à¸“à¸«à¸ à¸¹à¸¡à¸´à¸„à¸‡à¸—à¸µà¹ˆ à¸„à¸§à¸²à¸¡à¸”à¸±à¸™à¹€à¸à¸´à¹ˆà¸¡ 2 à¹€à¸—à¹ˆà¸² à¸›à¸£à¸´à¸¡à¸²à¸•à¸£à¸ˆà¸°à¹€à¸›à¹‡à¸™à¸­à¸¢à¹ˆà¸²à¸‡à¹„à¸£?", opts: ["à¹€à¸à¸´à¹ˆà¸¡ 2 à¹€à¸—à¹ˆà¸²", "à¸¥à¸”à¸¥à¸‡ Â½", "à¸„à¸‡à¹€à¸”à¸´à¸¡", "à¹€à¸à¸´à¹ˆà¸¡ 4 à¹€à¸—à¹ˆà¸²"], ans: 1, exp: "PV = à¸„à¸‡à¸—à¸µà¹ˆ à¸”à¸±à¸‡à¸™à¸±à¹‰à¸™ Pâ‚‚=2Pâ‚ â†’ Vâ‚‚=Vâ‚/2", topic: "à¸Ÿà¸´à¸ªà¸´à¸à¸ªà¹Œ" },
  { q: "à¸›à¸£à¸²à¸à¸à¸à¸²à¸£à¸“à¹Œà¸”à¸­à¸›à¹€à¸›à¸¥à¸­à¸£à¹Œ: à¹à¸«à¸¥à¹ˆà¸‡à¸à¸³à¹€à¸™à¸´à¸”à¹€à¸ªà¸µà¸¢à¸‡à¹€à¸‚à¹‰à¸²à¸«à¸²à¸œà¸¹à¹‰à¸Ÿà¸±à¸‡ à¸„à¸§à¸²à¸¡à¸–à¸µà¹ˆà¸—à¸µà¹ˆà¹„à¸”à¹‰à¸¢à¸´à¸™à¹€à¸›à¹‡à¸™à¸­à¸¢à¹ˆà¸²à¸‡à¹„à¸£?", opts: ["à¹€à¸—à¹ˆà¸²à¹€à¸”à¸´à¸¡", "à¸ªà¸¹à¸‡à¸à¸§à¹ˆà¸²à¸„à¸§à¸²à¸¡à¸–à¸µà¹ˆà¸ˆà¸£à¸´à¸‡", "à¸•à¹ˆà¸³à¸à¸§à¹ˆà¸²à¸„à¸§à¸²à¸¡à¸–à¸µà¹ˆà¸ˆà¸£à¸´à¸‡", "à¹€à¸ªà¸µà¸¢à¸‡à¸”à¸±à¸‡à¸‚à¸¶à¹‰à¸™"], ans: 1, exp: "à¸„à¸¥à¸·à¹ˆà¸™à¸–à¸¹à¸à¸­à¸±à¸”à¸à¸±à¸™ â†’ à¸„à¸§à¸²à¸¡à¸–à¸µà¹ˆà¸ªà¸¹à¸‡à¸‚à¸¶à¹‰à¸™ (à¹à¸«à¸¥à¸¡à¸‚à¸¶à¹‰à¸™)", topic: "à¸Ÿà¸´à¸ªà¸´à¸à¸ªà¹Œ" },
  { q: "à¹à¸ªà¸‡à¸ªà¸µà¹à¸”à¸‡à¹à¸¥à¸°à¸ªà¸µà¸¡à¹ˆà¸§à¸‡ à¸•à¹ˆà¸²à¸‡à¸à¸±à¸™à¸­à¸¢à¹ˆà¸²à¸‡à¹„à¸£?", opts: ["à¸ªà¸µà¹à¸”à¸‡à¹€à¸£à¹‡à¸§à¸à¸§à¹ˆà¸²à¹ƒà¸™à¸­à¸²à¸à¸²à¸¨", "à¸ªà¸µà¹à¸”à¸‡à¸„à¸§à¸²à¸¡à¸¢à¸²à¸§à¸„à¸¥à¸·à¹ˆà¸™à¸¢à¸²à¸§à¸à¸§à¹ˆà¸² à¸„à¸§à¸²à¸¡à¸–à¸µà¹ˆà¸•à¹ˆà¸³à¸à¸§à¹ˆà¸²", "à¸ªà¸µà¸¡à¹ˆà¸§à¸‡à¸à¸¥à¸±à¸‡à¸‡à¸²à¸™à¸™à¹‰à¸­à¸¢à¸à¸§à¹ˆà¸²", "à¹„à¸¡à¹ˆà¸•à¹ˆà¸²à¸‡à¸à¸±à¸™"], ans: 1, exp: "à¹à¸”à¸‡ Î»â‰ˆ700nm à¸„à¸§à¸²à¸¡à¸–à¸µà¹ˆà¸•à¹ˆà¸³, à¸¡à¹ˆà¸§à¸‡ Î»â‰ˆ400nm à¸„à¸§à¸²à¸¡à¸–à¸µà¹ˆà¸ªà¸¹à¸‡", topic: "à¸Ÿà¸´à¸ªà¸´à¸à¸ªà¹Œ" },
  { q: "à¸à¸³à¸¥à¸±à¸‡à¹„à¸Ÿà¸Ÿà¹‰à¸²à¸‚à¸­à¸‡à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¹ƒà¸Šà¹‰à¹„à¸Ÿà¸Ÿà¹‰à¸² 220V 5A à¹€à¸—à¹ˆà¸²à¹ƒà¸”?", opts: ["44 W", "225 W", "1100 W", "44 kW"], ans: 2, exp: "P = IV = 5 Ã— 220 = 1100 W", topic: "à¸Ÿà¸´à¸ªà¸´à¸à¸ªà¹Œ" },
  { q: "à¸à¸à¸Šà¸²à¸£à¹Œà¸¥: 27Â°C â†’ 327Â°C à¸—à¸µà¹ˆà¸„à¸§à¸²à¸¡à¸”à¸±à¸™à¸„à¸‡à¸—à¸µà¹ˆ à¸›à¸£à¸´à¸¡à¸²à¸•à¸£à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸­à¸¢à¹ˆà¸²à¸‡à¹„à¸£?", opts: ["à¹€à¸à¸´à¹ˆà¸¡ 12 à¹€à¸—à¹ˆà¸²", "à¹€à¸à¸´à¹ˆà¸¡à¹€à¸›à¹‡à¸™ 2 à¹€à¸—à¹ˆà¸²", "à¸¥à¸”à¸¥à¸‡ Â½", "à¸„à¸‡à¹€à¸”à¸´à¸¡"], ans: 1, exp: "27Â°C=300K, 327Â°C=600K â†’ Vâ‚‚/Vâ‚=600/300=2", topic: "à¸Ÿà¸´à¸ªà¸´à¸à¸ªà¹Œ" },
  { q: "à¹ƒà¸™à¸§à¸‡à¸ˆà¸£à¸­à¸™à¸¸à¸à¸£à¸¡ à¸à¸£à¸°à¹à¸ªà¹ƒà¸™à¹à¸•à¹ˆà¸¥à¸°à¸•à¸±à¸§à¸•à¹‰à¸²à¸™à¸—à¸²à¸™à¹€à¸›à¹‡à¸™à¸­à¸¢à¹ˆà¸²à¸‡à¹„à¸£?", opts: ["à¸•à¹ˆà¸²à¸‡à¸à¸±à¸™", "à¹€à¸—à¹ˆà¸²à¸à¸±à¸™", "à¸‚à¸¶à¹‰à¸™à¸à¸±à¸šà¸„à¸§à¸²à¸¡à¸•à¹‰à¸²à¸™à¸—à¸²à¸™", "à¸‚à¸¶à¹‰à¸™à¸à¸±à¸šà¹à¸£à¸‡à¸”à¸±à¸™"], ans: 1, exp: "à¸§à¸‡à¸ˆà¸£à¸­à¸™à¸¸à¸à¸£à¸¡: à¸à¸£à¸°à¹à¸ªà¹€à¸—à¹ˆà¸²à¸à¸±à¸™à¸—à¸¸à¸à¸•à¸±à¸§", topic: "à¸Ÿà¸´à¸ªà¸´à¸à¸ªà¹Œ" },
  { q: "[à¹à¸£à¸‡à¸ªà¸¹à¹ˆà¸¨à¸¹à¸™à¸¢à¹Œà¸à¸¥à¸²à¸‡]à¸‚à¸­à¸‡à¸”à¸²à¸§à¹€à¸—à¸µà¸¢à¸¡à¸£à¸­à¸šà¹‚à¸¥à¸à¸„à¸·à¸­à¹à¸£à¸‡à¸­à¸°à¹„à¸£?", opts: ["à¹à¸£à¸‡à¸‚à¸±à¸šà¸”à¸±à¸™", "à¹à¸£à¸‡à¹‚à¸™à¹‰à¸¡à¸–à¹ˆà¸§à¸‡à¸‚à¸­à¸‡à¹‚à¸¥à¸", "à¹à¸£à¸‡à¹€à¸ªà¸µà¸¢à¸”à¸—à¸²à¸™à¸šà¸£à¸£à¸¢à¸²à¸à¸²à¸¨", "à¹à¸£à¸‡à¹à¸¡à¹ˆà¹€à¸«à¸¥à¹‡à¸"], ans: 1, exp: "à¹à¸£à¸‡à¹‚à¸™à¹‰à¸¡à¸–à¹ˆà¸§à¸‡à¸‚à¸­à¸‡à¹‚à¸¥à¸à¹€à¸›à¹‡à¸™[à¹à¸£à¸‡à¸ªà¸¹à¹ˆà¸¨à¸¹à¸™à¸¢à¹Œà¸à¸¥à¸²à¸‡]", topic: "à¸Ÿà¸´à¸ªà¸´à¸à¸ªà¹Œ" },
  { q: "à¸­à¸°à¸•à¸­à¸¡: à¸­à¸°à¹„à¸£à¸­à¸¢à¸¹à¹ˆà¸™à¸­à¸à¸™à¸´à¸§à¹€à¸„à¸¥à¸µà¸¢à¸ª?", opts: ["à¹‚à¸›à¸£à¸•à¸­à¸™ à¸™à¸´à¸§à¸•à¸£à¸­à¸™ à¸­à¸´à¹€à¸¥à¹‡à¸à¸•à¸£à¸­à¸™ â€” à¸­à¸´à¹€à¸¥à¹‡à¸à¸•à¸£à¸­à¸™à¸­à¸¢à¸¹à¹ˆà¸™à¸­à¸", "à¹‚à¸›à¸£à¸•à¸­à¸™ à¸™à¸´à¸§à¸•à¸£à¸­à¸™ â€” à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¹ƒà¸™à¸™à¸´à¸§à¹€à¸„à¸¥à¸µà¸¢à¸ª", "à¸­à¸´à¹€à¸¥à¹‡à¸à¸•à¸£à¸­à¸™à¸­à¸¢à¸¹à¹ˆà¹ƒà¸™à¸™à¸´à¸§à¹€à¸„à¸¥à¸µà¸¢à¸ª", "à¸™à¸´à¸§à¸•à¸£à¸­à¸™à¸­à¸¢à¸¹à¹ˆà¸™à¸­à¸à¸™à¸´à¸§à¹€à¸„à¸¥à¸µà¸¢à¸ª"], ans: 0, exp: "à¸™à¸´à¸§à¹€à¸„à¸¥à¸µà¸¢à¸ª = à¹‚à¸›à¸£à¸•à¸­à¸™(+) + à¸™à¸´à¸§à¸•à¸£à¸­à¸™(0), à¸­à¸´à¹€à¸¥à¹‡à¸à¸•à¸£à¸­à¸™(-) à¸§à¸™à¸£à¸­à¸šà¸™à¸­à¸", topic: "à¹€à¸„à¸¡à¸µ" },
  { q: "[à¸à¸±à¸™à¸˜à¸°à¹‚à¸„à¸§à¸²à¹€à¸¥à¸™à¸•à¹Œ]à¸•à¹ˆà¸²à¸‡à¸ˆà¸²à¸[à¸à¸±à¸™à¸˜à¸°à¹„à¸­à¸­à¸­à¸™à¸´à¸]à¸­à¸¢à¹ˆà¸²à¸‡à¹„à¸£?", opts: ["à¹‚à¸„à¸§à¸²à¹€à¸¥à¸™à¸•à¹Œà¹€à¸à¸´à¸”à¹ƒà¸™à¹‚à¸¥à¸«à¸°", "à¹‚à¸„à¸§à¸²à¹€à¸¥à¸™à¸•à¹Œà¹ƒà¸Šà¹‰ eâ»à¸£à¹ˆà¸§à¸¡à¸à¸±à¸™ à¹„à¸­à¸­à¸­à¸™à¸´à¸à¸–à¹ˆà¸²à¸¢à¹‚à¸­à¸™ eâ»", "à¹„à¸­à¸­à¸­à¸™à¸´à¸à¹€à¸à¸´à¸”à¹ƒà¸™à¸ªà¸²à¸£à¸­à¸´à¸™à¸—à¸£à¸µà¸¢à¹Œ", "à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸±à¸™"], ans: 1, exp: "[à¸à¸±à¸™à¸˜à¸°à¹‚à¸„à¸§à¸²à¹€à¸¥à¸™à¸•à¹Œ]: Hâ‚‚O COâ‚‚ [à¸à¸±à¸™à¸˜à¸°à¹„à¸­à¸­à¸­à¸™à¸´à¸]: NaCl", topic: "à¹€à¸„à¸¡à¸µ" },
  { q: "pH à¸‚à¸­à¸‡à¸™à¹‰à¸³à¸¡à¸°à¸™à¸²à¸§ (pHâ‰ˆ2) à¸•à¹ˆà¸²à¸‡à¸ˆà¸²à¸à¸™à¹‰à¸³ (pH=7) à¸à¸µà¹ˆà¹€à¸—à¹ˆà¸²?", opts: ["5 à¹€à¸—à¹ˆà¸²", "100,000 à¹€à¸—à¹ˆà¸²", "10 à¹€à¸—à¹ˆà¸²", "1,000 à¹€à¸—à¹ˆà¸²"], ans: 1, exp: "pH à¹€à¸›à¹‡à¸™à¸¥à¹‡à¸­à¸à¸²à¸—à¸¶à¸¡ à¸•à¹ˆà¸²à¸‡à¸à¸±à¸™ 5 à¸«à¸™à¹ˆà¸§à¸¢ = [Hâº] à¸•à¹ˆà¸²à¸‡à¸à¸±à¸™ 10âµ = 100,000 à¹€à¸—à¹ˆà¸²", topic: "à¹€à¸„à¸¡à¸µ" },
  { q: "[à¹€à¸¥à¸‚à¸­à¸²à¹‚à¸§à¸à¸²à¹‚à¸”à¸£]à¸¡à¸µà¸„à¹ˆà¸² 6.022Ã—10Â²Â³ à¹ƒà¸Šà¹‰à¸—à¸³à¸­à¸°à¹„à¸£?", opts: ["à¸™à¸±à¸šà¸ˆà¸³à¸™à¸§à¸™à¸­à¸°à¸•à¸­à¸¡à¹ƒà¸™à¸à¹Šà¸²à¸‹", "à¹à¸›à¸¥à¸‡à¸£à¸°à¸”à¸±à¸šà¸­à¸°à¸•à¸­à¸¡à¹€à¸›à¹‡à¸™à¸à¸£à¸±à¸¡", "à¸„à¸³à¸™à¸§à¸“à¸„à¸§à¸²à¸¡à¸”à¸±à¸™", "à¸«à¸²à¸„à¸§à¸²à¸¡à¹€à¸£à¹‡à¸§à¹‚à¸¡à¹€à¸¥à¸à¸¸à¸¥"], ans: 1, exp: "1 à¹‚à¸¡à¸¥ = 6.022Ã—10Â²Â³ à¸­à¸™à¸¸à¸ à¸²à¸„", topic: "à¹€à¸„à¸¡à¸µ" },
  { q: "à¸•à¸±à¸§à¹€à¸£à¹ˆà¸‡à¸›à¸à¸´à¸à¸´à¸£à¸´à¸¢à¸²à¸¥à¸”[à¸à¸¥à¸±à¸‡à¸‡à¸²à¸™à¸à¸£à¸°à¸•à¸¸à¹‰à¸™]à¹à¸•à¹ˆà¹„à¸¡à¹ˆà¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸­à¸°à¹„à¸£?", opts: ["à¸›à¸£à¸´à¸¡à¸²à¸“à¸œà¸¥à¸´à¸•à¸ à¸±à¸“à¸‘à¹Œ", "à¸ªà¸¡à¸”à¸¸à¸¥à¹à¸¥à¸°à¸­à¸¸à¸“à¸«à¸à¸¥à¸¨à¸²à¸ªà¸•à¸£à¹Œ", "à¸„à¸§à¸²à¸¡à¹€à¸£à¹‡à¸§à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™", "à¸­à¸¸à¸“à¸«à¸ à¸¹à¸¡à¸´"], ans: 1, exp: "à¸•à¸±à¸§à¹€à¸£à¹ˆà¸‡à¹€à¸à¸´à¹ˆà¸¡à¸­à¸±à¸•à¸£à¸²à¸—à¸±à¹‰à¸‡à¸ªà¸­à¸‡à¸—à¸´à¸¨à¹€à¸—à¹ˆà¸²à¸à¸±à¸™ à¸ˆà¸¶à¸‡à¹„à¸¡à¹ˆà¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸ªà¸¡à¸”à¸¸à¸¥", topic: "à¹€à¸„à¸¡à¸µ" },
  { q: "[à¸ªà¸°à¸›à¸­à¸™à¸™à¸´à¸Ÿà¸´à¹€à¸„à¸Šà¸±à¸™]à¸„à¸·à¸­à¸›à¸à¸´à¸à¸´à¸£à¸´à¸¢à¸²à¸à¸²à¸£à¸—à¸³à¸­à¸°à¹„à¸£?", opts: ["à¸Ÿà¸­à¸à¸‚à¸²à¸§", "à¸—à¸³à¸ªà¸šà¸¹à¹ˆ", "à¸—à¸³à¸à¸¥à¸²à¸ªà¸•à¸´à¸", "à¸¢à¹ˆà¸­à¸¢à¹‚à¸›à¸£à¸•à¸µà¸™"], ans: 1, exp: "[à¸ªà¸°à¸›à¸­à¸™à¸™à¸´à¸Ÿà¸´à¹€à¸„à¸Šà¸±à¸™]: à¹„à¸‚à¸¡à¸±à¸™ + NaOH â†’ à¸ªà¸šà¸¹à¹ˆ + à¸à¸¥à¸µà¹€à¸‹à¸­à¸£à¸­à¸¥", topic: "à¹€à¸„à¸¡à¸µ" },
  { q: "[à¸«à¸¥à¸±à¸à¸à¸²à¸£à¹€à¸¥à¸­à¸Šà¸²à¹€à¸•à¸­à¸¥à¸´à¹€à¸¢à¸£à¹Œ]: Nâ‚‚+3Hâ‚‚â‡Œ2NHâ‚ƒ (à¸„à¸²à¸¢à¸„à¸§à¸²à¸¡à¸£à¹‰à¸­à¸™) à¸–à¹‰à¸²à¸­à¸¸à¸“à¸«à¸ à¸¹à¸¡à¸´à¸ªà¸¹à¸‡à¸‚à¸¶à¹‰à¸™?", opts: ["NHâ‚ƒ à¸¡à¸²à¸à¸‚à¸¶à¹‰à¸™", "NHâ‚ƒ à¸¥à¸”à¸¥à¸‡ (à¸ªà¸¡à¸”à¸¸à¸¥à¹€à¸¥à¸·à¹ˆà¸­à¸™à¸‹à¹‰à¸²à¸¢)", "à¹„à¸¡à¹ˆà¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™", "à¸›à¸à¸´à¸à¸´à¸£à¸´à¸¢à¸²à¸«à¸¢à¸¸à¸”"], ans: 1, exp: "à¸›à¸à¸´à¸à¸´à¸£à¸´à¸¢à¸²à¸„à¸²à¸¢à¸„à¸§à¸²à¸¡à¸£à¹‰à¸­à¸™ + à¸­à¸¸à¸“à¸«à¸ à¸¹à¸¡à¸´à¸ªà¸¹à¸‡ â†’ à¸ªà¸¡à¸”à¸¸à¸¥à¹€à¸¥à¸·à¹ˆà¸­à¸™à¸‹à¹‰à¸²à¸¢ NHâ‚ƒ à¸¥à¸”", topic: "à¹€à¸„à¸¡à¸µ" },
  { q: "[à¸ªà¸²à¸£à¸¥à¸°à¸¥à¸²à¸¢à¸šà¸±à¸Ÿà¹€à¸Ÿà¸­à¸£à¹Œ]à¹ƒà¸™à¹€à¸¥à¸·à¸­à¸”à¸¡à¸™à¸¸à¸©à¸¢à¹Œà¸£à¸±à¸à¸©à¸² pH à¹€à¸—à¹ˆà¸²à¹„à¸£?", opts: ["6.5", "7.0", "7.4", "8.0"], ans: 2, exp: "à¹€à¸¥à¸·à¸­à¸”à¸£à¸±à¸à¸©à¸² pH â‰ˆ 7.35-7.45", topic: "à¹€à¸„à¸¡à¸µ" },
  { q: "[à¸à¸­à¸¥à¸´à¹€à¸¡à¸­à¸£à¹Œ]à¸˜à¸£à¸£à¸¡à¸Šà¸²à¸•à¸´à¹ƒà¸”à¹€à¸›à¹‡à¸™à¸­à¸‡à¸„à¹Œà¸›à¸£à¸°à¸à¸­à¸šà¸œà¸™à¸±à¸‡à¹€à¸‹à¸¥à¸¥à¹Œà¸à¸·à¸Š?", opts: ["à¹à¸›à¹‰à¸‡", "à¹„à¸„à¸•à¸´à¸™", "[à¹€à¸‹à¸¥à¸¥à¸¹à¹‚à¸¥à¸ª]", "à¸„à¸­à¸¥à¸¥à¸²à¹€à¸ˆà¸™"], ans: 2, exp: "[à¹€à¸‹à¸¥à¸¥à¸¹à¹‚à¸¥à¸ª]à¹€à¸›à¹‡à¸™[à¸à¸­à¸¥à¸´à¹€à¸¡à¸­à¸£à¹Œ]à¸à¸¥à¸¹à¹‚à¸„à¸ª Î²-1,4", topic: "à¹€à¸„à¸¡à¸µ" },
  { q: "à¸à¹Šà¸²à¸‹à¹€à¸‰à¸·à¹ˆà¸­à¸¢à¸—à¸³à¹„à¸¡à¸ˆà¸¶à¸‡à¹€à¸ªà¸–à¸µà¸¢à¸£?", opts: ["à¸¡à¸µà¸¡à¸§à¸¥à¸™à¹‰à¸­à¸¢", "à¸¡à¸µà¹€à¸§à¹€à¸¥à¸™à¸‹à¹Œà¸­à¸´à¹€à¸¥à¹‡à¸à¸•à¸£à¸­à¸™à¸„à¸£à¸š 8 (Octet)", "à¹€à¸›à¹‡à¸™à¸à¹Šà¸²à¸‹", "à¹„à¸¡à¹ˆà¸¡à¸µà¸™à¸´à¸§à¸•à¸£à¸­à¸™"], ans: 1, exp: "à¸à¸ Octet: à¸­à¸°à¸•à¸­à¸¡à¹€à¸ªà¸–à¸µà¸¢à¸£à¹€à¸¡à¸·à¹ˆà¸­à¸¡à¸µ 8eâ» à¸Šà¸±à¹‰à¸™à¸™à¸­à¸à¸ªà¸¸à¸”", topic: "à¹€à¸„à¸¡à¸µ" },
  { q: "Fe à¸¡à¸²à¸ˆà¸²à¸à¸ à¸²à¸©à¸²à¸­à¸°à¹„à¸£ à¹à¸¥à¸°à¸„à¸·à¸­à¸˜à¸²à¸•à¸¸à¹ƒà¸”?", opts: ["à¸à¸£à¸±à¹ˆà¸‡à¹€à¸¨à¸ª à¸„à¸·à¸­à¸—à¸­à¸‡à¹à¸”à¸‡", "à¸¥à¸°à¸•à¸´à¸™ Ferrum à¸„à¸·à¸­à¹€à¸«à¸¥à¹‡à¸", "à¸à¸£à¸µà¸ à¸„à¸·à¸­à¸—à¸­à¸‡à¸„à¸³", "à¸à¸µà¹ˆà¸›à¸¸à¹ˆà¸™ à¸„à¸·à¸­à¹€à¸‡à¸´à¸™"], ans: 1, exp: "Fe = Ferrum (à¸¥à¸°à¸•à¸´à¸™) = à¹€à¸«à¸¥à¹‡à¸", topic: "à¹€à¸„à¸¡à¸µ" },
  { q: "à¸­à¸±à¸¥à¹€à¸„à¸™ à¸•à¹ˆà¸²à¸‡à¸ˆà¸²à¸ à¸­à¸±à¸¥à¸„à¸µà¸™ à¸­à¸¢à¹ˆà¸²à¸‡à¹„à¸£?", opts: ["à¸­à¸±à¸¥à¹€à¸„à¸™à¸¡à¸µà¸à¸±à¸™à¸˜à¸°à¸„à¸¹à¹ˆ C=C", "à¸­à¸±à¸¥à¹€à¸„à¸™à¸à¸±à¸™à¸˜à¸°à¹€à¸”à¸µà¹ˆà¸¢à¸§à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” à¸­à¸±à¸¥à¸„à¸µà¸™à¸¡à¸µà¸à¸±à¸™à¸˜à¸°à¸„à¸¹à¹ˆ", "à¸­à¸±à¸¥à¸„à¸µà¸™à¸¡à¸µà¸à¸±à¸™à¸˜à¸°à¸ªà¸²à¸¡", "à¹„à¸¡à¹ˆà¸•à¹ˆà¸²à¸‡à¸à¸±à¸™"], ans: 1, exp: "à¸­à¸±à¸¥à¹€à¸„à¸™ Câ‚™Hâ‚‚â‚™â‚Šâ‚‚ (à¸à¸±à¸™à¸˜à¸°à¹€à¸”à¸µà¹ˆà¸¢à¸§), à¸­à¸±à¸¥à¸„à¸µà¸™ Câ‚™Hâ‚‚â‚™ (à¸¡à¸µà¸à¸±à¸™à¸˜à¸°à¸„à¸¹à¹ˆ)", topic: "à¹€à¸„à¸¡à¸µ" },
  { q: "à¸¡à¸§à¸¥à¹‚à¸¡à¸¥à¸²à¸£à¹Œà¸‚à¸­à¸‡ Hâ‚‚SOâ‚„ à¸„à¸·à¸­à¹€à¸—à¹ˆà¸²à¹ƒà¸”? (H=1 S=32 O=16)", opts: ["49 g/mol", "98 g/mol", "64 g/mol", "146 g/mol"], ans: 1, exp: "Hâ‚‚SOâ‚„: 2+32+64 = 98 g/mol", topic: "à¹€à¸„à¸¡à¸µ" },
  { q: "COâ‚‚ à¸—à¸³à¹ƒà¸«à¹‰à¸™à¹‰à¸³à¸›à¸¹à¸™à¸‚à¸²à¸§à¸‚à¸¸à¹ˆà¸™à¹€à¸à¸£à¸²à¸°à¸›à¸à¸´à¸à¸´à¸£à¸´à¸¢à¸²à¹ƒà¸”?", opts: ["COâ‚‚+Hâ‚‚Oâ†’Hâ‚‚COâ‚ƒ", "COâ‚‚+Ca(OH)â‚‚â†’CaCOâ‚ƒâ†“+Hâ‚‚O", "COâ‚‚+CaOâ†’CaCOâ‚ƒ", "COâ‚‚+2NaOHâ†’Naâ‚‚COâ‚ƒ+Hâ‚‚O"], ans: 1, exp: "CaCOâ‚ƒ à¹„à¸¡à¹ˆà¸¥à¸°à¸¥à¸²à¸¢à¸™à¹‰à¸³ à¸•à¸à¸•à¸°à¸à¸­à¸™à¸ªà¸µà¸‚à¸²à¸§", topic: "à¹€à¸„à¸¡à¸µ" },
  { q: "à¸›à¸à¸´à¸à¸´à¸£à¸´à¸¢à¸²à¸ªà¸°à¹€à¸—à¸´à¸™ HCl + NaOH â†’ ?", opts: ["Hâ‚‚ + NaClâ‚‚", "NaCl + Hâ‚‚O", "Na + HClO", "NaOHâ‚‚ + Cl"], ans: 1, exp: "à¸à¸£à¸”à¹à¸à¹ˆ + à¹€à¸šà¸ªà¹à¸à¹ˆ â†’ à¹€à¸à¸¥à¸·à¸­ + à¸™à¹‰à¸³ à¹„à¸”à¹‰ NaCl à¸—à¸µà¹ˆà¹€à¸›à¹‡à¸™à¸à¸¥à¸²à¸‡", topic: "à¹€à¸„à¸¡à¸µ" },
  { q: "[à¹„à¸¡à¹‚à¸•à¸„à¸­à¸™à¹€à¸”à¸£à¸µà¸¢]à¸œà¸¥à¸´à¸•à¸­à¸°à¹„à¸£?", opts: ["à¸à¸¥à¸¹à¹‚à¸„à¸ª", "ATP", "DNA", "à¹‚à¸›à¸£à¸•à¸µà¸™"], ans: 1, exp: "[à¹„à¸¡à¹‚à¸•à¸„à¸­à¸™à¹€à¸”à¸£à¸µà¸¢]à¸œà¸¥à¸´à¸• ATP à¸œà¹ˆà¸²à¸™ Oxidative Phosphorylation", topic: "à¸Šà¸µà¸§à¸§à¸´à¸—à¸¢à¸²" },
  { q: "[à¹„à¸¡à¹‚à¸—à¸‹à¸´à¸ª]à¸¡à¸µà¸à¸µà¹ˆà¸£à¸°à¸¢à¸°?", opts: ["2 à¸£à¸°à¸¢à¸°", "4 à¸£à¸°à¸¢à¸°", "6 à¸£à¸°à¸¢à¸°", "8 à¸£à¸°à¸¢à¸°"], ans: 1, exp: "[à¹„à¸¡à¹‚à¸—à¸‹à¸´à¸ª] 4 à¸£à¸°à¸¢à¸°: Prophase â†’ Metaphase â†’ Anaphase â†’ Telophase", topic: "à¸Šà¸µà¸§à¸§à¸´à¸—à¸¢à¸²" },
  { q: "[à¹„à¸¡à¹‚à¸­à¸‹à¸´à¸ª]à¸•à¹ˆà¸²à¸‡à¸ˆà¸²à¸[à¹„à¸¡à¹‚à¸—à¸‹à¸´à¸ª]à¸­à¸¢à¹ˆà¸²à¸‡à¹„à¸£?", opts: ["à¹„à¸¡à¹‚à¸­à¸‹à¸´à¸ªà¹€à¸£à¹‡à¸§à¸à¸§à¹ˆà¸²", "à¹„à¸¡à¹‚à¸­à¸‹à¸´à¸ªà¸ªà¸£à¹‰à¸²à¸‡à¹€à¸‹à¸¥à¸¥à¹Œà¸®à¸²à¸à¸¥à¸­à¸¢à¸”à¹Œ (n) à¹à¸¥à¸°à¸¡à¸µ Crossing Over", "à¹„à¸¡à¹‚à¸­à¸‹à¸´à¸ªà¹€à¸à¸´à¸”à¸—à¸¸à¸à¹€à¸‹à¸¥à¸¥à¹Œ", "à¹„à¸¡à¹‚à¸­à¸‹à¸´à¸ªà¹„à¸¡à¹ˆà¸¡à¸µà¸à¸²à¸£à¹à¸¢à¸à¹‚à¸„à¸£à¹‚à¸¡à¹‚à¸‹à¸¡"], ans: 1, exp: "[à¹„à¸¡à¹‚à¸­à¸‹à¸´à¸ª] I à¸¡à¸µ Crossing Over à¸ªà¸£à¹‰à¸²à¸‡à¸„à¸§à¸²à¸¡à¸«à¸¥à¸²à¸à¸«à¸¥à¸²à¸¢à¸—à¸²à¸‡à¸à¸±à¸™à¸˜à¸¸à¸à¸£à¸£à¸¡", topic: "à¸Šà¸µà¸§à¸§à¸´à¸—à¸¢à¸²" },
  { q: "[à¸®à¸µà¹‚à¸¡à¹‚à¸à¸¥à¸šà¸´à¸™]à¸«à¸™à¸¶à¹ˆà¸‡à¹‚à¸¡à¹€à¸¥à¸à¸¸à¸¥à¸ˆà¸±à¸šà¸­à¸­à¸à¸‹à¸´à¹€à¸ˆà¸™à¹„à¸”à¹‰à¸à¸µà¹ˆà¹‚à¸¡à¹€à¸¥à¸à¸¸à¸¥?", opts: ["1", "2", "4", "8"], ans: 2, exp: "[à¸®à¸µà¹‚à¸¡à¹‚à¸à¸¥à¸šà¸´à¸™] 4 à¸«à¸™à¹ˆà¸§à¸¢à¸¢à¹ˆà¸­à¸¢ à¹à¸•à¹ˆà¸¥à¸°à¸«à¸™à¹ˆà¸§à¸¢à¸ˆà¸±à¸š Oâ‚‚ 1 à¹‚à¸¡à¹€à¸¥à¸à¸¸à¸¥ à¸£à¸§à¸¡ 4", topic: "à¸Šà¸µà¸§à¸§à¸´à¸—à¸¢à¸²" },
  { q: "[à¹à¸­à¸™à¸•à¸´à¸šà¸­à¸”à¸µ]à¸¡à¸µà¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¸­à¸¢à¹ˆà¸²à¸‡à¹„à¸£?", opts: ["à¸£à¸¹à¸›à¸§à¸‡à¸à¸¥à¸¡", "à¸£à¸¹à¸›à¸•à¸±à¸§ Y", "à¸£à¸¹à¸›à¹€à¸à¸¥à¸µà¸¢à¸§", "à¸£à¸¹à¸›à¹à¸œà¹ˆà¸™à¹à¸šà¸™"], ans: 1, exp: "[à¹à¸­à¸™à¸•à¸´à¸šà¸­à¸”à¸µ]à¸£à¸¹à¸› Y à¸ªà¹ˆà¸§à¸™ Variable à¸ˆà¸±à¸š Antigen à¹€à¸‰à¸à¸²à¸°", topic: "à¸Šà¸µà¸§à¸§à¸´à¸—à¸¢à¸²" },
  { q: "[à¸­à¸­à¸ªà¹‚à¸¡à¸‹à¸´à¸ª]à¸—à¸´à¸¨à¸—à¸²à¸‡à¸à¸²à¸£à¹„à¸«à¸¥à¸‚à¸­à¸‡à¸™à¹‰à¸³à¹€à¸›à¹‡à¸™à¸­à¸¢à¹ˆà¸²à¸‡à¹„à¸£?", opts: ["à¸ˆà¸²à¸à¹€à¸‚à¹‰à¸¡à¸‚à¹‰à¸™à¹„à¸›à¹€à¸ˆà¸·à¸­à¸ˆà¸²à¸‡", "à¸ˆà¸²à¸à¹€à¸ˆà¸·à¸­à¸ˆà¸²à¸‡à¹„à¸›à¹€à¸‚à¹‰à¸¡à¸‚à¹‰à¸™", "à¸—à¸±à¹‰à¸‡à¸ªà¸­à¸‡à¸—à¸´à¸¨à¹€à¸—à¹ˆà¸²à¸à¸±à¸™", "à¸‚à¸¶à¹‰à¸™à¸à¸±à¸šà¸­à¸¸à¸“à¸«à¸ à¸¹à¸¡à¸´"], ans: 1, exp: "à¸™à¹‰à¸³[à¸­à¸­à¸ªà¹‚à¸¡à¸‹à¸´à¸ª]à¸ˆà¸²à¸ Hypotonicâ†’Hypertonic", topic: "à¸Šà¸µà¸§à¸§à¸´à¸—à¸¢à¸²" },
  { q: "[à¹„à¸à¸¥à¹‚à¸„à¹„à¸¥à¸‹à¸´à¸ª]à¸œà¸¥à¸´à¸• ATP à¸ªà¸¸à¸—à¸˜à¸´à¸à¸µà¹ˆà¹‚à¸¡à¸¥?", opts: ["2 ATP", "8 ATP", "32 ATP", "36 ATP"], ans: 0, exp: "[à¹„à¸à¸¥à¹‚à¸„à¹„à¸¥à¸‹à¸´à¸ª]: à¸à¸¥à¸¹à¹‚à¸„à¸ª 1 mol â†’ ATP à¸ªà¸¸à¸—à¸˜à¸´ 2 mol", topic: "à¸Šà¸µà¸§à¸§à¸´à¸—à¸¢à¸²" },
  { q: "[à¸à¸²à¸£à¸„à¸±à¸”à¹€à¸¥à¸·à¸­à¸à¹‚à¸”à¸¢à¸˜à¸£à¸£à¸¡à¸Šà¸²à¸•à¸´]à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¹€à¸‡à¸·à¹ˆà¸­à¸™à¹„à¸‚à¹ƒà¸”?", opts: ["à¸ªà¸´à¹ˆà¸‡à¸¡à¸µà¸Šà¸µà¸§à¸´à¸•à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸±à¸™", "à¸„à¸§à¸²à¸¡à¹à¸›à¸£à¸œà¸±à¸™ + à¸à¸²à¸£à¸–à¹ˆà¸²à¸¢à¸—à¸­à¸”à¸à¸±à¸™à¸˜à¸¸à¸à¸£à¸£à¸¡ + à¸„à¸§à¸²à¸¡à¸•à¹ˆà¸²à¸‡à¹ƒà¸™à¸à¸²à¸£à¸­à¸¢à¸¹à¹ˆà¸£à¸­à¸”", "à¸ªà¸ à¸²à¸à¹à¸§à¸”à¸¥à¹‰à¸­à¸¡à¸„à¸‡à¸—à¸µà¹ˆ", "à¸›à¸£à¸°à¸Šà¸²à¸à¸£à¸™à¹‰à¸­à¸¢"], ans: 1, exp: "Darwin: à¸„à¸§à¸²à¸¡à¹à¸›à¸£à¸œà¸±à¸™ â†’ à¸šà¸²à¸‡à¸¥à¸±à¸à¸©à¸“à¸°à¸Šà¹ˆà¸§à¸¢à¸­à¸¢à¸¹à¹ˆà¸£à¸­à¸” â†’ à¸–à¹ˆà¸²à¸¢à¸—à¸­à¸”à¸ªà¸¹à¹ˆà¸£à¸¸à¹ˆà¸™à¸¥à¸¹à¸", topic: "à¸Šà¸µà¸§à¸§à¸´à¸—à¸¢à¸²" },
  { q: "à¸ªà¸¡à¸­à¸‡à¸™à¹‰à¸­à¸¢ (Cerebellum) à¸„à¸§à¸šà¸„à¸¸à¸¡à¸­à¸°à¹„à¸£?", opts: ["à¸„à¸§à¸²à¸¡à¸„à¸´à¸”à¹à¸¥à¸°à¸ªà¸•à¸´à¸›à¸±à¸à¸à¸²", "à¸à¸²à¸£à¸—à¸£à¸‡à¸•à¸±à¸§à¹à¸¥à¸°à¸›à¸£à¸°à¸ªà¸²à¸™à¸‡à¸²à¸™à¸à¸¥à¹‰à¸²à¸¡à¹€à¸™à¸·à¹‰à¸­", "à¸à¸²à¸£à¸¡à¸­à¸‡à¹€à¸«à¹‡à¸™", "à¸à¸²à¸£à¸«à¸²à¸¢à¹ƒà¸ˆ"], ans: 1, exp: "Cerebellum à¸„à¸§à¸šà¸„à¸¸à¸¡à¸à¸²à¸£à¸›à¸£à¸°à¸ªà¸²à¸™à¸‡à¸²à¸™à¹à¸¥à¸°à¸à¸²à¸£à¸—à¸£à¸‡à¸•à¸±à¸§", topic: "à¸Šà¸µà¸§à¸§à¸´à¸—à¸¢à¸²" },
  { q: "à¸œà¸™à¸±à¸‡à¹€à¸‹à¸¥à¸¥à¹Œà¸à¸·à¸Šà¸—à¸³à¸ˆà¸²à¸à¸­à¸°à¹„à¸£?", opts: ["à¹‚à¸›à¸£à¸•à¸µà¸™", "[à¹€à¸‹à¸¥à¸¥à¸¹à¹‚à¸¥à¸ª]", "à¹„à¸„à¸•à¸´à¸™", "à¹€à¸à¸à¸•à¸´à¸™"], ans: 1, exp: "[à¹€à¸‹à¸¥à¸¥à¸¹à¹‚à¸¥à¸ª]à¹€à¸›à¹‡à¸™ Polysaccharide à¹ƒà¸«à¹‰à¸„à¸§à¸²à¸¡à¹à¸‚à¹‡à¸‡à¹à¸£à¸‡à¹à¸à¹ˆà¹€à¸‹à¸¥à¸¥à¹Œà¸à¸·à¸Š", topic: "à¸Šà¸µà¸§à¸§à¸´à¸—à¸¢à¸²" },
  { q: "à¸§à¸±à¸à¸ˆà¸±à¸à¸£à¸„à¸±à¸¥à¸§à¸´à¸™ (Calvin Cycle) à¹€à¸à¸´à¸”à¸—à¸µà¹ˆà¹ƒà¸”à¹ƒà¸™[à¸„à¸¥à¸­à¹‚à¸£à¸à¸¥à¸²à¸ªà¸•à¹Œ]?", opts: ["Thylakoid", "Grana", "Stroma", "Outer membrane"], ans: 2, exp: "Stroma à¸¡à¸µà¹€à¸­à¸™à¹„à¸‹à¸¡à¹Œ RuBisCO à¸•à¸£à¸¶à¸‡ COâ‚‚", topic: "à¸Šà¸µà¸§à¸§à¸´à¸—à¸¢à¸²" },
  { q: "à¹‚à¸£à¸„à¸”à¸²à¸§à¸™à¹Œà¸‹à¸´à¸™à¹‚à¸”à¸£à¸¡à¹€à¸à¸´à¸”à¸ˆà¸²à¸à¹‚à¸„à¸£à¹‚à¸¡à¹‚à¸‹à¸¡à¸„à¸¹à¹ˆà¸—à¸µà¹ˆà¹€à¸—à¹ˆà¸²à¹„à¸£?", opts: ["à¸„à¸¹à¹ˆà¸—à¸µà¹ˆ 21 à¸¡à¸µ 3 à¹à¸—à¹ˆà¸‡", "à¸„à¸¹à¹ˆà¸—à¸µà¹ˆ 23 à¸¡à¸µ 3 à¹à¸—à¹ˆà¸‡", "à¸„à¸¹à¹ˆà¸—à¸µà¹ˆ 1 à¸«à¸²à¸¢à¹„à¸›", "à¸„à¸¹à¹ˆà¸—à¸µà¹ˆ 14 à¸ªà¸¥à¸±à¸š"], ans: 0, exp: "Trisomy 21: à¹‚à¸„à¸£à¹‚à¸¡à¹‚à¸‹à¸¡à¸„à¸¹à¹ˆà¸—à¸µà¹ˆ 21 à¹€à¸à¸´à¸™ 1 à¹à¸—à¹ˆà¸‡", topic: "à¸Šà¸µà¸§à¸§à¸´à¸—à¸¢à¸²" },
  { q: "à¹„à¸§à¸£à¸±à¸ªà¸•à¹ˆà¸²à¸‡à¸ˆà¸²à¸à¹à¸šà¸„à¸—à¸µà¹€à¸£à¸µà¸¢à¸­à¸¢à¹ˆà¸²à¸‡à¹„à¸£?", opts: ["à¹„à¸§à¸£à¸±à¸ªà¸¡à¸µà¸‚à¸™à¸²à¸”à¹ƒà¸«à¸à¹ˆà¸à¸§à¹ˆà¸²", "à¹„à¸§à¸£à¸±à¸ªà¹„à¸¡à¹ˆà¸¡à¸µà¹€à¸‹à¸¥à¸¥à¹Œ à¸•à¹‰à¸­à¸‡à¸­à¸²à¸¨à¸±à¸¢à¹‚à¸®à¸ªà¸•à¹Œà¸ªà¸·à¸šà¸à¸±à¸™à¸˜à¸¸à¹Œ", "à¹à¸šà¸„à¸—à¸µà¹€à¸£à¸µà¸¢à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¹‚à¸®à¸ªà¸•à¹Œ", "à¹„à¸§à¸£à¸±à¸ªà¸¡à¸µ DNA à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™"], ans: 1, exp: "à¹„à¸§à¸£à¸±à¸ª: à¹„à¸¡à¹ˆà¸¡à¸µà¹€à¸‹à¸¥à¸¥à¹Œ à¸•à¹‰à¸­à¸‡à¹ƒà¸Šà¹‰ Ribosome à¸‚à¸­à¸‡à¹‚à¸®à¸ªà¸•à¹Œ", topic: "à¸Šà¸µà¸§à¸§à¸´à¸—à¸¢à¸²" },
];

function shuffle(arr) { const a = [...arr]; for (let i = a.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1));[a[i], a[j]] = [a[j], a[i]]; } return a; }
function pick50() {
  const p = shuffle(ALL_Q.filter(q => q.topic === "à¸Ÿà¸´à¸ªà¸´à¸à¸ªà¹Œ")).slice(0, 17);
  const c = shuffle(ALL_Q.filter(q => q.topic === "à¹€à¸„à¸¡à¸µ")).slice(0, 17);
  const b = shuffle(ALL_Q.filter(q => q.topic === "à¸Šà¸µà¸§à¸§à¸´à¸—à¸¢à¸²")).slice(0, 16);
  return shuffle([...p, ...c, ...b]);
}

// â”€â”€â”€ AI QUESTION GENERATION (Google Gemini) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function generateQuizQuestions(apiKey) {
  if (!apiKey) throw new Error("No API key provided");

  const prompt = `à¸ªà¸£à¹‰à¸²à¸‡à¸„à¸³à¸–à¸²à¸¡à¸§à¸´à¸—à¸¢à¸²à¸¨à¸²à¸ªà¸•à¸£à¹Œà¸£à¸°à¸”à¸±à¸šà¸¡à¸±à¸˜à¸¢à¸¡à¸›à¸¥à¸²à¸¢ 50 à¸‚à¹‰à¸­à¹€à¸›à¹‡à¸™à¸ à¸²à¸©à¸²à¹„à¸—à¸¢ à¹à¸šà¹ˆà¸‡à¹€à¸›à¹‡à¸™:
- à¸Ÿà¸´à¸ªà¸´à¸à¸ªà¹Œ 17 à¸‚à¹‰à¸­ (à¸à¸¥à¸¨à¸²à¸ªà¸•à¸£à¹Œ à¸„à¸¥à¸·à¹ˆà¸™ à¹à¸ªà¸‡ à¹„à¸Ÿà¸Ÿà¹‰à¸² à¸­à¸¸à¸“à¸«à¸à¸¥à¸¨à¸²à¸ªà¸•à¸£à¹Œ à¸Ÿà¸´à¸ªà¸´à¸à¸ªà¹Œà¸­à¸°à¸•à¸­à¸¡)
- à¹€à¸„à¸¡à¸µ 17 à¸‚à¹‰à¸­ (à¸à¸±à¸™à¸˜à¸°à¹€à¸„à¸¡à¸µ à¸ªà¸¡à¸”à¸¸à¸¥à¹€à¸„à¸¡à¸µ à¸à¸£à¸”-à¹€à¸šà¸ª à¸­à¸´à¸™à¸—à¸£à¸µà¸¢à¹Œà¹€à¸„à¸¡à¸µ à¸•à¸²à¸£à¸²à¸‡à¸˜à¸²à¸•à¸¸ à¸›à¸à¸´à¸à¸´à¸£à¸´à¸¢à¸²à¹€à¸„à¸¡à¸µ)
- à¸Šà¸µà¸§à¸§à¸´à¸—à¸¢à¸² 16 à¸‚à¹‰à¸­ (à¹€à¸‹à¸¥à¸¥à¹Œ à¸à¸±à¸™à¸˜à¸¸à¸¨à¸²à¸ªà¸•à¸£à¹Œ à¸§à¸´à¸§à¸±à¸’à¸™à¸²à¸à¸²à¸£ à¸£à¹ˆà¸²à¸‡à¸à¸²à¸¢à¸¡à¸™à¸¸à¸©à¸¢à¹Œ à¸™à¸´à¹€à¸§à¸¨à¸§à¸´à¸—à¸¢à¸²)

à¸•à¸­à¸šà¹€à¸›à¹‡à¸™ JSON array à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™ à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¸¡à¸µà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸­à¸·à¹ˆà¸™ à¸£à¸¹à¸›à¹à¸šà¸š:
[{"q":"à¸„à¸³à¸–à¸²à¸¡","opts":["à¸•à¸±à¸§à¹€à¸¥à¸·à¸­à¸1","à¸•à¸±à¸§à¹€à¸¥à¸·à¸­à¸2","à¸•à¸±à¸§à¹€à¸¥à¸·à¸­à¸3","à¸•à¸±à¸§à¹€à¸¥à¸·à¸­à¸4"],"ans":0,"exp":"à¸„à¸³à¸­à¸˜à¸´à¸šà¸²à¸¢à¸ªà¸±à¹‰à¸™à¹†","topic":"à¸Ÿà¸´à¸ªà¸´à¸à¸ªà¹Œ"}]

à¸à¸:
1. à¹à¸•à¹ˆà¸¥à¸°à¸‚à¹‰à¸­à¸¡à¸µ 4 à¸•à¸±à¸§à¹€à¸¥à¸·à¸­à¸ à¸•à¸±à¸§à¹€à¸¥à¸·à¸­à¸à¸–à¸¹à¸à¸­à¸¢à¸¹à¹ˆà¸•à¸³à¹à¸«à¸™à¹ˆà¸‡ ans (0-3) à¸ªà¸¸à¹ˆà¸¡à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¹ƒà¸«à¹‰à¸«à¸¥à¸²à¸à¸«à¸¥à¸²à¸¢
2. à¸„à¸³à¸–à¸²à¸¡à¸•à¹‰à¸­à¸‡à¸«à¸¥à¸²à¸à¸«à¸¥à¸²à¸¢ à¹„à¸¡à¹ˆà¸‹à¹‰à¸³à¸à¸±à¸™ à¸„à¸£à¸­à¸šà¸„à¸¥à¸¸à¸¡à¸«à¸±à¸§à¸‚à¹‰à¸­à¸¢à¹ˆà¸­à¸¢
3. à¸£à¸°à¸”à¸±à¸šà¸„à¸§à¸²à¸¡à¸¢à¸²à¸: à¸‡à¹ˆà¸²à¸¢ 30% à¸›à¸²à¸™à¸à¸¥à¸²à¸‡ 50% à¸¢à¸²à¸ 20%
4. à¸„à¸³à¸­à¸˜à¸´à¸šà¸²à¸¢ (exp) à¸•à¹‰à¸­à¸‡à¸à¸£à¸°à¸Šà¸±à¸šà¹à¸•à¹ˆà¹ƒà¸«à¹‰à¸„à¸§à¸²à¸¡à¸£à¸¹à¹‰
5. topic à¸•à¹‰à¸­à¸‡à¹€à¸›à¹‡à¸™ "à¸Ÿà¸´à¸ªà¸´à¸à¸ªà¹Œ" à¸«à¸£à¸·à¸­ "à¹€à¸„à¸¡à¸µ" à¸«à¸£à¸·à¸­ "à¸Šà¸µà¸§à¸§à¸´à¸—à¸¢à¸²" à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™
6. à¸•à¸­à¸šà¹€à¸›à¹‡à¸™ JSON array à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™ à¸«à¹‰à¸²à¸¡à¸¡à¸µ markdown à¸«à¸£à¸·à¸­à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸­à¸·à¹ˆà¸™`;

  const GEMINI_MODEL = "gemini-2.0-flash";
  const url = `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent?key=${apiKey}`;

  const res = await fetch(url, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      contents: [{ parts: [{ text: prompt }] }],
      generationConfig: {
        temperature: 0.8,
        maxOutputTokens: 8000,
        responseMimeType: "application/json",
      },
    }),
  });

  if (!res.ok) {
    const errData = await res.json().catch(() => ({}));
    throw new Error("Gemini API failed: " + (errData?.error?.message || res.status));
  }
  const data = await res.json();
  const text = data?.candidates?.[0]?.content?.parts?.[0]?.text || "";

  // Parse JSON â€” handle possible markdown wrappers
  let jsonStr = text.trim();
  const jsonMatch = jsonStr.match(/\[\s*\{[\s\S]*\}\s*\]/);
  if (jsonMatch) jsonStr = jsonMatch[0];

  const questions = JSON.parse(jsonStr);

  // Validate structure
  const validTopics = ["à¸Ÿà¸´à¸ªà¸´à¸à¸ªà¹Œ", "à¹€à¸„à¸¡à¸µ", "à¸Šà¸µà¸§à¸§à¸´à¸—à¸¢à¸²"];
  const valid = questions.filter(q =>
    q.q && Array.isArray(q.opts) && q.opts.length === 4 &&
    typeof q.ans === "number" && q.ans >= 0 && q.ans <= 3 &&
    q.exp && validTopics.includes(q.topic)
  );

  if (valid.length < 30) throw new Error("Not enough valid questions: " + valid.length);

  // If we got fewer than 50, pad with hardcoded
  if (valid.length < 50) {
    const needed = 50 - valid.length;
    const fallback = shuffle(ALL_Q).slice(0, needed);
    return shuffle([...valid, ...fallback]);
  }

  return shuffle(valid.slice(0, 50));
}

// â”€â”€â”€ CSS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const CSS = `
@import url('https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700;800&family=Noto+Sans+Thai:wght@300;400;500;600;700&display=swap');
*{box-sizing:border-box;margin:0;padding:0;}
html,body{height:100%;background:#0c1018;}
body{font-family:'Noto Sans Thai','Crimson Pro',serif;color:white;-webkit-font-smoothing:antialiased;}
::-webkit-scrollbar{width:3px;height:3px;}
::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.1);border-radius:99px;}
@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes scaleIn{from{opacity:0;transform:scale(0.93)}to{opacity:1;transform:scale(1)}}
@keyframes slideUp{from{opacity:0;transform:translateY(40px)}to{opacity:1;transform:translateY(0)}}
@keyframes pulse{0%,100%{opacity:.5;transform:scale(1)}50%{opacity:1;transform:scale(1.15)}}
@keyframes spin{to{transform:rotate(360deg)}}
.fu{animation:fadeUp .4s ease both;}
.fi{animation:fadeIn .3s ease both;}
.si{animation:scaleIn .28s cubic-bezier(.34,1.5,.64,1) both;}
.su{animation:slideUp .35s cubic-bezier(.22,1,.36,1) both;}
.opt{transition:background .15s,transform .12s,border-color .15s;cursor:pointer;border:none;text-align:left;width:100%;min-height:52px;}
.opt:not(:disabled):hover{background:rgba(255,255,255,0.06)!important;transform:translateX(4px);}
.btn{transition:all .2s ease;cursor:pointer;border:none;min-height:44px;display:inline-flex;align-items:center;justify-content:center;}
.btn:hover{filter:brightness(1.12);transform:translateY(-1px);}
.btn:active{transform:scale(.97);}
input,textarea{outline:none;-webkit-appearance:none;}
input:focus{border-color:rgba(96,165,250,.6)!important;box-shadow:0 0 0 3px rgba(96,165,250,.1)!important;}
.trow{transition:background .12s;cursor:pointer;}
.trow:hover{background:rgba(255,255,255,0.03)!important;}
@media(max-width:639px){
  .hide-m{display:none!important;}
  .quiz-layout{flex-direction:column!important;}
  .sidebar-q{display:none!important;}
  .mgmt-grid{grid-template-columns:1fr!important;}
  .dash-stats{grid-template-columns:repeat(2,1fr)!important;}
  .topic-bars{grid-template-columns:1fr!important;}
}
@media(min-width:768px){.quiz-layout{flex-direction:row!important;}}
`;

// â”€â”€â”€ TERM RENDERER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function Tx({ text, onTerm }) {
  if (!text) return null;
  const parts = []; const re = /\[([^\]]+)\]/g; let last = 0, m;
  while ((m = re.exec(text)) !== null) { if (m.index > last) parts.push({ t: "txt", v: text.slice(last, m.index) }); parts.push({ t: "trm", v: m[1] }); last = m.index + m[0].length; }
  if (last < text.length) parts.push({ t: "txt", v: text.slice(last) });
  return (<span>{parts.map((p, i) => p.t === "txt" ? <span key={i}>{p.v}</span> : <button key={i} className="btn" onClick={e => { e.stopPropagation(); onTerm(p.v); }} style={{ background: "rgba(251,191,36,.15)", border: "1px solid rgba(251,191,36,.4)", borderRadius: 4, padding: "1px 5px", color: "#fde68a", fontSize: "inherit", fontFamily: "inherit", fontWeight: 700, display: "inline", transform: "none" }}>{p.v}</button>)}</span>);
}

// â”€â”€â”€ GLOSSARY MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function GlossaryModal({ term, onClose, isMobile }) {
  if (!term) return null;
  const d = GL[term];
  const cfg = d?.cat ? TC[d.cat] : { c: "#94a3b8", bg: "rgba(148,163,184,0.08)", bd: "rgba(148,163,184,0.2)", icon: "ğŸ“–" };
  return (
    <div onClick={onClose} style={{ position: "fixed", inset: 0, background: "rgba(0,0,0,.65)", zIndex: 1000, display: "flex", alignItems: isMobile ? "flex-end" : "center", justifyContent: "center", backdropFilter: "blur(6px)", padding: isMobile ? 0 : 24 }}>
      <div onClick={e => e.stopPropagation()} className="su" style={{ width: "100%", maxWidth: isMobile ? "100%" : 480, background: "#141824", borderRadius: isMobile ? "20px 20px 0 0" : 20, overflow: "hidden", boxShadow: "0 30px 80px rgba(0,0,0,.6)", border: "1px solid rgba(255,255,255,.08)", maxHeight: isMobile ? "88vh" : "80vh", display: "flex", flexDirection: "column" }}>
        {isMobile && <div style={{ display: "flex", justifyContent: "center", padding: "12px 0 6px" }}><div style={{ width: 40, height: 4, borderRadius: 99, background: "rgba(255,255,255,.15)" }} /></div>}
        <div style={{ background: `linear-gradient(135deg,${cfg.bg},transparent)`, borderBottom: "1px solid rgba(255,255,255,.06)", padding: "20px 24px 16px", flexShrink: 0 }}>
          <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start", gap: 12 }}>
            <div><div style={{ fontSize: 10, color: cfg.c, fontWeight: 700, letterSpacing: ".1em", textTransform: "uppercase", marginBottom: 6 }}>{cfg.icon} {d?.cat || "à¸„à¸³à¸¨à¸±à¸à¸—à¹Œ"}</div>
              <h2 style={{ fontSize: 22, fontWeight: 800, color: "#f1f5f9", fontFamily: "'Crimson Pro',serif", lineHeight: 1.2 }}>{term}</h2>
              {d?.en && <p style={{ fontSize: 12, color: "#475569", marginTop: 3, fontStyle: "italic" }}>{d.en}</p>}
            </div>
            <button onClick={onClose} className="btn" style={{ background: "rgba(255,255,255,.07)", border: "1px solid rgba(255,255,255,.1)", borderRadius: 10, width: 36, height: 36, color: "#64748b", fontSize: 16, flexShrink: 0, transform: "none" }}>âœ•</button>
          </div>
        </div>
        <div style={{ padding: "18px 24px 28px", overflowY: "auto" }}>
          {d ? <><div style={{ background: "rgba(255,255,255,.03)", border: "1px solid rgba(255,255,255,.06)", borderRadius: 12, padding: 16, marginBottom: 14 }}><p style={{ fontSize: 14, color: "#cbd5e1", lineHeight: 1.85 }}>{d.def}</p></div>
            {d.ex && <div style={{ background: cfg.bg, border: `1px solid ${cfg.bd}`, borderRadius: 12, padding: "13px 16px" }}><p style={{ fontSize: 11, color: cfg.c, fontWeight: 700, marginBottom: 5 }}>ğŸ’¡ à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡</p><p style={{ fontSize: 13, color: "#94a3b8", lineHeight: 1.75 }}>{d.ex}</p></div>}</>
            : <p style={{ color: "#475569", fontSize: 14, textAlign: "center", padding: "20px 0" }}>à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸³à¸«à¸£à¸±à¸šà¸„à¸³à¸™à¸µà¹‰</p>}
        </div>
      </div>
    </div>
  );
}

// â”€â”€â”€ TIMER RING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function Ring({ progress, color, size = 52, stroke = 4 }) {
  const r = (size - stroke) / 2, c = 2 * Math.PI * r;
  return (<svg width={size} height={size} style={{ transform: "rotate(-90deg)", display: "block", flexShrink: 0 }}><circle cx={size / 2} cy={size / 2} r={r} fill="none" stroke="rgba(255,255,255,.06)" strokeWidth={stroke} /><circle cx={size / 2} cy={size / 2} r={r} fill="none" stroke={color} strokeWidth={stroke} strokeDasharray={c} strokeDashoffset={c * (1 - Math.max(0, Math.min(1, progress)))} strokeLinecap="round" style={{ transition: "stroke-dashoffset 1s linear, stroke .4s ease" }} /></svg>);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  LOGIN SCREEN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function LoginScreen({ onLogin }) {
  const [id, setId] = useState("");
  const [err, setErr] = useState("");
  const [loading, setLoading] = useState(false);

  const go = async () => {
    const v = id.trim().toUpperCase();
    if (!v) { setErr("à¸à¸£à¸¸à¸“à¸²à¸à¸£à¸­à¸ ID"); return; }
    setLoading(true); setErr("");
    if (v === ADMIN_CODE) { onLogin({ role: "admin", id: v }); return; }
    const result = await accounts.validate(v);
    if (!result.ok) { setErr(result.msg); setLoading(false); return; }
    onLogin({ role: "member", id: result.account.id, name: result.account.name });
  };

  return (
    <div style={{ minHeight: "100dvh", background: "#0c1018", display: "flex", alignItems: "center", justifyContent: "center", padding: 24, fontFamily: "'Noto Sans Thai','Crimson Pro',serif", color: "white" }}>
      <style>{CSS}</style>
      <div style={{ position: "fixed", inset: 0, pointerEvents: "none" }}>
        <div style={{ position: "absolute", top: "20%", left: "50%", transform: "translateX(-50%)", width: "min(600px,80vw)", height: "min(600px,80vw)", background: "radial-gradient(circle,rgba(96,165,250,.05) 0%,transparent 65%)", borderRadius: "50%" }} />
        <svg style={{ position: "absolute", inset: 0, width: "100%", height: "100%", opacity: .018 }}><defs><pattern id="g0" width="56" height="56" patternUnits="userSpaceOnUse"><path d="M56 0L0 0 0 56" fill="none" stroke="white" strokeWidth=".5" /></pattern></defs><rect width="100%" height="100%" fill="url(#g0)" /></svg>
      </div>
      <div className="fu" style={{ width: "100%", maxWidth: 400, position: "relative", zIndex: 1 }}>
        <div style={{ textAlign: "center", marginBottom: 36 }}>
          <div style={{ width: 68, height: 68, borderRadius: 20, background: "linear-gradient(135deg,rgba(96,165,250,.18),rgba(52,211,153,.18))", border: "1px solid rgba(96,165,250,.28)", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 30, margin: "0 auto 18px" }}>ğŸ”¬</div>
          <h1 style={{ fontFamily: "'Crimson Pro',serif", fontSize: "clamp(24px,5vw,30px)", fontWeight: 700, color: "#f1f5f9", letterSpacing: "-.02em" }}>Science Quiz</h1>
          <p style={{ color: "#334155", fontSize: 13, marginTop: 6 }}>à¸Ÿà¸´à¸ªà¸´à¸à¸ªà¹Œ Â· à¹€à¸„à¸¡à¸µ Â· à¸Šà¸µà¸§à¸§à¸´à¸—à¸¢à¸²</p>
        </div>
        <div style={{ background: "rgba(255,255,255,.03)", border: "1px solid rgba(255,255,255,.08)", borderRadius: 22, padding: "28px 28px 24px" }}>
          <div style={{ marginBottom: 14 }}>
            <label style={{ fontSize: 10, color: "#475569", fontWeight: 700, letterSpacing: ".08em", textTransform: "uppercase", display: "block", marginBottom: 8 }}>Member ID</label>
            <input value={id} onChange={e => { setId(e.target.value.toUpperCase()); setErr(""); }} onKeyDown={e => e.key === "Enter" && go()}
              placeholder="à¹€à¸Šà¹ˆà¸™ ST001 à¸«à¸£à¸·à¸­à¸£à¸«à¸±à¸ª Admin"
              style={{ width: "100%", padding: "13px 16px", borderRadius: 12, background: "rgba(255,255,255,.04)", border: "1px solid rgba(255,255,255,.1)", color: "white", fontSize: 15, fontFamily: "'Noto Sans Thai',serif" }} />
          </div>
          {err && <p style={{ color: "#f87171", fontSize: 12, marginBottom: 12 }}>âš  {err}</p>}
          <button className="btn" onClick={go} disabled={loading}
            style={{ width: "100%", padding: "13px", borderRadius: 12, background: "linear-gradient(135deg,#3b82f6,#1d4ed8)", color: "white", fontSize: 15, fontWeight: 700, fontFamily: "'Noto Sans Thai',serif" }}>
            {loading ? "à¸à¸³à¸¥à¸±à¸‡à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š..." : "à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š â†’"}
          </button>
          <p style={{ textAlign: "center", color: "#334155", fontSize: 11, marginTop: 14, lineHeight: 1.6 }}>ğŸ’¡ à¸•à¹‰à¸­à¸‡à¹„à¸”à¹‰à¸£à¸±à¸š ID à¸ˆà¸²à¸ Admin à¸à¹ˆà¸­à¸™</p>
        </div>
        <p style={{ textAlign: "center", color: "#1e293b", fontSize: 11, marginTop: 16 }}>Science Quiz Â· à¸Ÿà¸´à¸ªà¸´à¸à¸ªà¹Œ à¹€à¸„à¸¡à¸µ à¸Šà¸µà¸§à¸§à¸´à¸—à¸¢à¸²</p>
      </div>
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ADMIN DASHBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function AdminDashboard({ onLogout }) {
  const { isMobile } = useBreakpoint();
  const [tab, setTab] = useState("scores");
  const [scores, setScores] = useState([]);
  const [sortBy, setSortBy] = useState("date");
  const [sortDir, setSortDir] = useState(-1);
  const [selected, setSelected] = useState(null);
  const [delConfirm, setDelConfirm] = useState(null);

  // â”€â”€ Account management state â”€â”€
  const [acctList, setAcctList] = useState([]);
  const [newId, setNewId] = useState("");
  const [newName, setNewName] = useState("");
  const [acctMsg, setAcctMsg] = useState(null);
  const [acctDelConfirm, setAcctDelConfirm] = useState(null);

  const createAccount = async () => {
    const id = newId.trim().toUpperCase();
    const name = newName.trim();
    if (!id) { setAcctMsg({ ok: false, text: "à¸à¸£à¸¸à¸“à¸²à¸à¸£à¸­à¸ Member ID" }); return; }
    if (!name) { setAcctMsg({ ok: false, text: "à¸à¸£à¸¸à¸“à¸²à¸à¸£à¸­à¸à¸Šà¸·à¹ˆà¸­-à¸™à¸²à¸¡à¸ªà¸à¸¸à¸¥" }); return; }
    if (id === ADMIN_CODE) { setAcctMsg({ ok: false, text: "à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹ƒà¸Šà¹‰à¸£à¸«à¸±à¸ª Admin à¹€à¸›à¹‡à¸™ Member ID à¹„à¸”à¹‰" }); return; }
    const result = await accounts.create(id, name);
    if (!result.ok) { setAcctMsg({ ok: false, text: result.msg }); return; }
    setNewId(""); setNewName("");
    setAcctMsg({ ok: true, text: `âœ“ à¸ªà¸£à¹‰à¸²à¸‡à¸šà¸±à¸à¸Šà¸µ "${name}" (${id}) à¸ªà¸³à¹€à¸£à¹‡à¸ˆ` });
    setTimeout(() => setAcctMsg(null), 4000);
  };
  const deleteAccount = async (id) => {
    await accounts.remove(id);
    setAcctDelConfirm(null);
  };

  // Real-time scores from Firebase
  useEffect(() => {
    const unsub = fbDb.onScores(setScores);
    const unsubAcct = accounts.onAccounts(setAcctList);
    return () => { unsub(); unsubAcct(); };
  }, []);

  const overallAvg = scores.length ? Math.round(scores.reduce((s, r) => s + r.pct, 0) / scores.length) : null;
  const topicAvg = t => {
    const rel = scores.filter(s => s.topicScores?.[t]);
    if (!rel.length) return null;
    return Math.round(rel.reduce((sum, s) => sum + (s.topicScores[t].ok / s.topicScores[t].total * 100), 0) / rel.length);
  };

  const delScore = async (fbKey) => {
    await fbDb.deleteScore(fbKey);
    setDelConfirm(null);
    setSelected(null);
  };

  const sortedScores = [...scores].sort((a, b) => {
    if (sortBy === "date") return sortDir * (new Date(a.date) - new Date(b.date));
    if (sortBy === "score") return sortDir * (a.pct - b.pct);
    if (sortBy === "name") return sortDir * (a.name || "").localeCompare(b.name || "");
    return 0;
  });
  const Th = ({ col, children }) => (
    <th onClick={() => { if (sortBy === col) setSortDir(d => -d); else { setSortBy(col); setSortDir(-1); } }}
      style={{ padding: "11px 14px", textAlign: "left", fontSize: 11, color: sortBy === col ? "#60a5fa" : "#334155", fontWeight: 700, letterSpacing: ".07em", textTransform: "uppercase", cursor: "pointer", userSelect: "none", whiteSpace: "nowrap", background: "rgba(255,255,255,.02)" }}>
      {children} {sortBy === col ? (sortDir > 0 ? "â†‘" : "â†“") : ""}
    </th>
  );

  // Unique members
  const members = [...new Map(scores.map(s => [s.id, { id: s.id, name: s.name, scores: scores.filter(r => r.id === s.id) }])).values()];

  return (
    <div style={{ minHeight: "100vh", background: "#0c1018", fontFamily: "'Noto Sans Thai','Crimson Pro',serif", color: "white" }}>
      <style>{CSS}</style>
      {/* Topbar */}
      <div style={{ borderBottom: "1px solid rgba(255,255,255,.06)", padding: "0 clamp(14px,4vw,32px)", display: "flex", alignItems: "center", justifyContent: "space-between", height: 58, background: "rgba(12,16,24,.95)", backdropFilter: "blur(12px)", position: "sticky", top: 0, zIndex: 10, gap: 12 }}>
        <div style={{ display: "flex", alignItems: "center", gap: 10, minWidth: 0 }}>
          <span style={{ fontSize: 18 }}>ğŸ”¬</span>
          <span style={{ fontFamily: "'Crimson Pro',serif", fontSize: "clamp(14px,3vw,18px)", fontWeight: 700, color: "#e2e8f0", overflow: "hidden", textOverflow: "ellipsis", whiteSpace: "nowrap" }}>Science Quiz</span>
          <span className="hide-m" style={{ fontSize: 10, color: "#334155", padding: "3px 10px", borderRadius: 99, background: "rgba(96,165,250,.08)", border: "1px solid rgba(96,165,250,.15)" }}>Admin Panel</span>
        </div>
        <button className="btn" onClick={onLogout} style={{ padding: "7px 16px", borderRadius: 8, background: "rgba(248,113,113,.08)", border: "1px solid rgba(248,113,113,.2)", color: "#f87171", fontSize: 13, fontWeight: 600, fontFamily: "'Noto Sans Thai',serif", transform: "none" }}>à¸­à¸­à¸</button>
      </div>

      <div style={{ maxWidth: 1100, margin: "0 auto", padding: "clamp(14px,3vw,32px)" }}>
        {/* Stats */}
        <div className="fu dash-stats" style={{ display: "grid", gridTemplateColumns: "repeat(4,1fr)", gap: 12, marginBottom: 20 }}>
          {[["ğŸ‘¤", members.length, "Members", "#60a5fa"], ["ğŸ“‹", scores.length, "à¸„à¸£à¸±à¹‰à¸‡à¸—à¸³à¹à¸šà¸šà¸—à¸”à¸ªà¸­à¸š", "#34d399"], ["%", overallAvg != null ? overallAvg + "%" : "â€”", "à¸„à¸°à¹à¸™à¸™à¹€à¸‰à¸¥à¸µà¹ˆà¸¢", "#fbbf24"], ["ğŸ”¥", scores.filter(s => s.pct >= 80).length, "à¸„à¸£à¸±à¹‰à¸‡à¸—à¸µà¹ˆà¹„à¸”à¹‰â‰¥80%", "#f472b6"]].map(([icon, val, label, color]) => (
            <div key={label} style={{ background: "rgba(255,255,255,.03)", border: "1px solid rgba(255,255,255,.07)", borderRadius: 14, padding: "16px clamp(12px,3vw,20px)" }}>
              <div style={{ fontSize: 11, color: "#334155", fontWeight: 600, letterSpacing: ".05em", textTransform: "uppercase", marginBottom: 8 }}>{icon} {label}</div>
              <div style={{ fontFamily: "'Crimson Pro',serif", fontSize: "clamp(24px,4vw,32px)", fontWeight: 700, color }}>{val}</div>
            </div>
          ))}
        </div>

        {/* Topic averages */}
        <div className="fu" style={{ background: "rgba(255,255,255,.03)", border: "1px solid rgba(255,255,255,.07)", borderRadius: 14, padding: "18px 20px", marginBottom: 20, animationDelay: ".05s" }}>
          <div style={{ fontSize: 11, color: "#334155", fontWeight: 700, letterSpacing: ".07em", textTransform: "uppercase", marginBottom: 14 }}>à¸„à¸°à¹à¸™à¸™à¹€à¸‰à¸¥à¸µà¹ˆà¸¢à¹à¸¢à¸à¸•à¸²à¸¡à¸§à¸´à¸Šà¸²</div>
          <div className="topic-bars" style={{ display: "grid", gridTemplateColumns: "repeat(3,1fr)", gap: 16 }}>
            {Object.entries(TC).map(([topic, cfg]) => {
              const avg = topicAvg(topic);
              return (
                <div key={topic}>
                  <div style={{ display: "flex", justifyContent: "space-between", marginBottom: 6 }}>
                    <span style={{ fontSize: 12, color: cfg.c, fontWeight: 700 }}>{cfg.icon} {topic}</span>
                    <span style={{ fontSize: 12, color: avg != null ? cfg.c : "#334155", fontFamily: "'Crimson Pro',serif", fontWeight: 700 }}>{avg != null ? avg + "%" : "â€”"}</span>
                  </div>
                  <div style={{ height: 5, background: "rgba(255,255,255,.05)", borderRadius: 99 }}>
                    <div style={{ height: "100%", width: (avg || 0) + "%", background: `linear-gradient(90deg,${cfg.c},${cfg.c}55)`, borderRadius: 99, transition: "width 1s ease" }} />
                  </div>
                </div>
              );
            })}
          </div>
        </div>

        {/* Tabs */}
        <div style={{ display: "flex", gap: 4, marginBottom: 18, background: "rgba(255,255,255,.03)", border: "1px solid rgba(255,255,255,.07)", borderRadius: 12, padding: 4, width: "fit-content", flexWrap: "wrap" }}>
          {[["scores", "ğŸ“Š à¸„à¸°à¹à¸™à¸™"], ["members", "ğŸ‘¤ Members"], ["accounts", "ğŸ‘¥ à¸ˆà¸±à¸”à¸à¸²à¸£à¸ªà¸¡à¸²à¸Šà¸´à¸"]].map(([t, l]) => (
            <button key={t} className="btn" onClick={() => setTab(t)} style={{ padding: "9px clamp(12px,2vw,20px)", borderRadius: 9, background: tab === t ? "rgba(96,165,250,.15)" : "transparent", color: tab === t ? "#93c5fd" : "#475569", fontFamily: "'Noto Sans Thai',serif", fontSize: "clamp(11px,2vw,13px)", fontWeight: tab === t ? 700 : 400, border: tab === t ? "1px solid rgba(96,165,250,.25)" : "1px solid transparent", transform: "none", minHeight: 36 }}>
              {l}
            </button>
          ))}
        </div>

        {/* â”€â”€ SCORES TAB â”€â”€ */}
        {tab === "scores" && (
          <div className="fi">
            {scores.length === 0 ? (
              <div style={{ background: "rgba(255,255,255,.03)", border: "1px solid rgba(255,255,255,.07)", borderRadius: 14, padding: 60, textAlign: "center" }}>
                <div style={{ fontSize: 40, marginBottom: 12 }}>ğŸ“¥</div>
                <p style={{ fontSize: 16, color: "#475569" }}>à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸„à¸°à¹à¸™à¸™</p>
                <p style={{ fontSize: 13, color: "#334155", marginTop: 6 }}>à¸„à¸°à¹à¸™à¸™à¸ˆà¸°à¸­à¸±à¸à¹€à¸”à¸•à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´à¹€à¸¡à¸·à¹ˆà¸­ Member à¸—à¸³à¸‚à¹‰à¸­à¸ªà¸­à¸šà¹€à¸ªà¸£à¹‡à¸ˆ</p>
              </div>
            ) : isMobile ? (
              <div style={{ display: "flex", flexDirection: "column", gap: 10 }}>
                {sortedScores.map((r, i) => {
                  const pc = r.pct >= 80 ? "#34d399" : r.pct >= 60 ? "#fbbf24" : "#f87171";
                  return (
                    <div key={i} className="trow" onClick={() => setSelected(r)} style={{ background: "rgba(255,255,255,.03)", border: "1px solid rgba(255,255,255,.07)", borderRadius: 12, padding: "14px 16px" }}>
                      <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start" }}>
                        <div><div style={{ fontSize: 14, color: "#e2e8f0", fontWeight: 700 }}>{r.name}</div><div style={{ fontSize: 11, color: "#334155", marginTop: 2 }}>ID: {r.id}</div></div>
                        <div style={{ textAlign: "right" }}><div style={{ fontFamily: "'Crimson Pro',serif", fontSize: 26, fontWeight: 700, color: pc }}>{r.pct}%</div><div style={{ fontSize: 11, color: "#334155" }}>{r.score}/{r.total}</div></div>
                      </div>
                    </div>
                  );
                })}
              </div>
            ) : (
              <div style={{ background: "rgba(255,255,255,.03)", border: "1px solid rgba(255,255,255,.07)", borderRadius: 14, overflow: "hidden" }}>
                <div style={{ overflowX: "auto" }}>
                  <table style={{ width: "100%", borderCollapse: "collapse", minWidth: 560 }}>
                    <thead><tr style={{ borderBottom: "1px solid rgba(255,255,255,.06)" }}>
                      <Th col="date">à¸§à¸±à¸™à¸—à¸µà¹ˆ</Th><Th col="name">Member</Th><Th col="score">à¸„à¸°à¹à¸™à¸™</Th>
                      <th style={{ padding: "11px 14px", fontSize: 11, color: "#334155", fontWeight: 700, letterSpacing: ".07em", textTransform: "uppercase", background: "rgba(255,255,255,.02)" }}>à¸§à¸´à¸Šà¸²</th>
                    </tr></thead>
                    <tbody>
                      {sortedScores.map((r, i) => {
                        const pc = r.pct >= 80 ? "#34d399" : r.pct >= 60 ? "#fbbf24" : "#f87171";
                        return (
                          <tr key={i} className="trow" onClick={() => setSelected(r)} style={{ borderBottom: "1px solid rgba(255,255,255,.04)" }}>
                            <td style={{ padding: "11px 14px", fontSize: 12, color: "#475569", whiteSpace: "nowrap" }}>{new Date(r.date).toLocaleDateString("th-TH", { day: "2-digit", month: "short", year: "2-digit" })}<br /><span style={{ color: "#1e293b" }}>{new Date(r.date).toLocaleTimeString("th-TH", { hour: "2-digit", minute: "2-digit" })}</span></td>
                            <td style={{ padding: "11px 14px" }}><span style={{ fontSize: 14, color: "#e2e8f0", fontWeight: 600 }}>{r.name}</span><br /><span style={{ fontSize: 11, color: "#334155" }}>({r.id})</span></td>
                            <td style={{ padding: "11px 14px" }}><span style={{ fontFamily: "'Crimson Pro',serif", fontSize: 22, fontWeight: 700, color: pc }}>{r.pct}%</span><span style={{ fontSize: 11, color: "#334155", marginLeft: 6 }}>{r.score}/{r.total}</span></td>
                            <td style={{ padding: "11px 14px" }}>
                              <div style={{ display: "flex", gap: 5, flexWrap: "wrap" }}>
                                {r.topicScores && Object.entries(r.topicScores).map(([t, s]) => { const cfg = TC[t] || {}; const p = Math.round(s.ok / s.total * 100); return <span key={t} style={{ fontSize: 10, padding: "2px 7px", borderRadius: 5, background: cfg.bg, border: `1px solid ${cfg.bd}`, color: cfg.c, fontWeight: 700 }}>{t} {p}%</span>; })}
                              </div>
                            </td>
                          </tr>
                        );
                      })}
                    </tbody>
                  </table>
                </div>
              </div>
            )}
          </div>
        )}

        {/* â”€â”€ MEMBERS TAB â”€â”€ */}
        {tab === "members" && (
          <div className="fi" style={{ display: "flex", flexDirection: "column", gap: 10 }}>
            {members.length === 0 ? (
              <div style={{ background: "rgba(255,255,255,.03)", border: "1px solid rgba(255,255,255,.07)", borderRadius: 14, padding: 60, textAlign: "center" }}>
                <p style={{ color: "#475569", fontSize: 15 }}>à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥ Member</p>
                <p style={{ color: "#334155", fontSize: 13, marginTop: 6 }}>Member à¸ˆà¸°à¸›à¸£à¸²à¸à¸à¸—à¸µà¹ˆà¸™à¸µà¹ˆà¸«à¸¥à¸±à¸‡à¸ˆà¸²à¸ Import Score</p>
              </div>
            ) : members.map(m => {
              const best = m.scores.length ? Math.max(...m.scores.map(s => s.pct)) : null;
              const avg = m.scores.length ? Math.round(m.scores.reduce((s, r) => s + r.pct, 0) / m.scores.length) : null;
              const pc = best >= 80 ? "#34d399" : best >= 60 ? "#fbbf24" : "#f87171";
              return (
                <div key={m.id} className="trow" onClick={() => setSelected({ _isMember: true, ...m })} style={{ background: "rgba(255,255,255,.03)", border: "1px solid rgba(255,255,255,.07)", borderRadius: 12, padding: "16px 18px", display: "flex", alignItems: "center", justifyContent: "space-between", gap: 16 }}>
                  <div style={{ flex: 1, minWidth: 0 }}>
                    <div style={{ fontSize: 15, color: "#e2e8f0", fontWeight: 700 }}>{m.name}</div>
                    <div style={{ fontSize: 11, color: "#334155", marginTop: 3 }}>ID: <span style={{ fontFamily: "monospace", color: "#475569" }}>{m.id}</span> Â· à¸—à¸³à¹à¸¥à¹‰à¸§ {m.scores.length} à¸„à¸£à¸±à¹‰à¸‡</div>
                  </div>
                  <div style={{ textAlign: "right", flexShrink: 0 }}>
                    <div style={{ fontFamily: "'Crimson Pro',serif", fontSize: 26, fontWeight: 700, color: pc }}>{best}%</div>
                    <div style={{ fontSize: 10, color: "#334155" }}>à¸ªà¸¹à¸‡à¸ªà¸¸à¸” Â· à¹€à¸‰à¸¥à¸µà¹ˆà¸¢ {avg}%</div>
                  </div>
                </div>
              );
            })}
          </div>
        )}


        {/* â”€â”€ ACCOUNTS TAB â”€â”€ */}
        {tab === "accounts" && (
          <div className="fi">
            {/* Create account form */}
            <div style={{ maxWidth: 560, marginBottom: 24 }}>
              <div style={{ background: "rgba(255,255,255,.03)", border: "1px solid rgba(255,255,255,.07)", borderRadius: 16, padding: "clamp(20px,4vw,28px)" }}>
                <h3 style={{ fontSize: 16, fontWeight: 700, color: "#e2e8f0", marginBottom: 6 }}>ğŸ‘¥ à¸ªà¸£à¹‰à¸²à¸‡à¸šà¸±à¸à¸Šà¸µà¸ªà¸¡à¸²à¸Šà¸´à¸à¹ƒà¸«à¸¡à¹ˆ</h3>
                <p style={{ fontSize: 13, color: "#475569", marginBottom: 20, lineHeight: 1.7 }}>à¸ªà¸£à¹‰à¸²à¸‡ ID à¹ƒà¸«à¹‰à¸ªà¸¡à¸²à¸Šà¸´à¸ â€” à¸ªà¸¡à¸²à¸Šà¸´à¸à¸ˆà¸°à¹ƒà¸Šà¹‰ ID à¸™à¸µà¹‰à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š</p>

                <div style={{ display: "grid", gap: 12, marginBottom: 14 }}>
                  <div>
                    <label style={{ fontSize: 10, color: "#475569", fontWeight: 700, letterSpacing: ".08em", textTransform: "uppercase", display: "block", marginBottom: 6 }}>Member ID</label>
                    <input value={newId} onChange={e => { setNewId(e.target.value.toUpperCase()); setAcctMsg(null); }}
                      placeholder="à¹€à¸Šà¹ˆà¸™ ST001"
                      style={{ width: "100%", padding: "12px 14px", borderRadius: 10, background: "rgba(255,255,255,.04)", border: "1px solid rgba(255,255,255,.1)", color: "white", fontSize: 14, fontFamily: "'Noto Sans Thai',serif" }} />
                  </div>
                  <div>
                    <label style={{ fontSize: 10, color: "#475569", fontWeight: 700, letterSpacing: ".08em", textTransform: "uppercase", display: "block", marginBottom: 6 }}>à¸Šà¸·à¹ˆà¸­-à¸™à¸²à¸¡à¸ªà¸à¸¸à¸¥</label>
                    <input value={newName} onChange={e => { setNewName(e.target.value); setAcctMsg(null); }}
                      placeholder="à¸à¸£à¸­à¸à¸Šà¸·à¹ˆà¸­à¸ªà¸¡à¸²à¸Šà¸´à¸"
                      style={{ width: "100%", padding: "12px 14px", borderRadius: 10, background: "rgba(255,255,255,.04)", border: "1px solid rgba(255,255,255,.1)", color: "white", fontSize: 14, fontFamily: "'Noto Sans Thai',serif" }} />
                  </div>
                </div>

                {acctMsg && (
                  <div style={{ marginBottom: 14, padding: "10px 14px", borderRadius: 10, background: acctMsg.ok ? "rgba(52,211,153,.08)" : "rgba(248,113,113,.08)", border: `1px solid ${acctMsg.ok ? "rgba(52,211,153,.25)" : "rgba(248,113,113,.25)"}`, color: acctMsg.ok ? "#34d399" : "#f87171", fontSize: 13 }}>
                    {acctMsg.text}
                  </div>
                )}

                <button className="btn" onClick={createAccount}
                  style={{ width: "100%", padding: "12px", borderRadius: 12, background: "linear-gradient(135deg,#3b82f6,#1d4ed8)", color: "white", fontSize: 15, fontWeight: 700, fontFamily: "'Noto Sans Thai',serif", transform: "none" }}>
                  à¸ªà¸£à¹‰à¸²à¸‡à¸šà¸±à¸à¸Šà¸µ
                </button>
              </div>
            </div>

            {/* Account list */}
            <div>
              <div style={{ fontSize: 11, color: "#334155", fontWeight: 700, letterSpacing: ".07em", textTransform: "uppercase", marginBottom: 12 }}>à¸ªà¸¡à¸²à¸Šà¸´à¸à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” ({acctList.length} à¸„à¸™)</div>
              {acctList.length === 0 ? (
                <div style={{ background: "rgba(255,255,255,.03)", border: "1px solid rgba(255,255,255,.07)", borderRadius: 14, padding: 40, textAlign: "center" }}>
                  <div style={{ fontSize: 32, marginBottom: 8 }}>ğŸ‘¤</div>
                  <p style={{ color: "#475569", fontSize: 14 }}>à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸šà¸±à¸à¸Šà¸µà¸ªà¸¡à¸²à¸Šà¸´à¸</p>
                  <p style={{ color: "#334155", fontSize: 12, marginTop: 4 }}>à¸ªà¸£à¹‰à¸²à¸‡à¸šà¸±à¸à¸Šà¸µà¸”à¹‰à¸²à¸™à¸šà¸™à¹€à¸à¸·à¹ˆà¸­à¹ƒà¸«à¹‰à¸ªà¸¡à¸²à¸Šà¸´à¸à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š</p>
                </div>
              ) : (
                <div style={{ display: "flex", flexDirection: "column", gap: 8 }}>
                  {acctList.map(acc => (
                    <div key={acc.id} style={{ background: "rgba(255,255,255,.03)", border: "1px solid rgba(255,255,255,.07)", borderRadius: 12, padding: "14px 16px", display: "flex", alignItems: "center", justifyContent: "space-between", gap: 12 }}>
                      <div style={{ flex: 1, minWidth: 0 }}>
                        <div style={{ fontSize: 14, color: "#e2e8f0", fontWeight: 700 }}>{acc.name}</div>
                        <div style={{ fontSize: 11, color: "#334155", marginTop: 2 }}>ID: <span style={{ fontFamily: "monospace", color: "#475569" }}>{acc.id}</span></div>
                        <div style={{ fontSize: 10, color: "#1e293b", marginTop: 2 }}>à¸ªà¸£à¹‰à¸²à¸‡à¹€à¸¡à¸·à¹ˆà¸­ {new Date(acc.createdAt).toLocaleDateString("th-TH", { day: "2-digit", month: "short", year: "2-digit" })}</div>
                      </div>
                      <button className="btn" onClick={() => setAcctDelConfirm(acc)} style={{ padding: "6px 12px", borderRadius: 8, background: "rgba(248,113,113,.08)", border: "1px solid rgba(248,113,113,.2)", color: "#f87171", fontSize: 12, fontWeight: 600, fontFamily: "'Noto Sans Thai',serif", transform: "none", minHeight: 32 }}>à¸¥à¸š</button>
                    </div>
                  ))}
                </div>
              )}
            </div>
          </div>
        )}
      </div>

      {/* Score / Member Detail Modal */}
      {selected && (() => {
        const isMember = selected._isMember;
        const scoreList = isMember ? selected.scores : [selected];
        const best = scoreList.length ? Math.max(...scoreList.map(r => r.pct)) : 0;
        const avg = scoreList.length ? Math.round(scoreList.reduce((s, r) => s + r.pct, 0) / scoreList.length) : 0;
        return (
          <div onClick={() => setSelected(null)} style={{ position: "fixed", inset: 0, background: "rgba(0,0,0,.75)", zIndex: 950, display: "flex", alignItems: "center", justifyContent: "center", padding: 20 }}>
            <div onClick={e => e.stopPropagation()} className="si" style={{ background: "#131720", border: "1px solid rgba(255,255,255,.1)", borderRadius: 18, padding: 24, maxWidth: 480, width: "100%", maxHeight: "85vh", overflowY: "auto" }}>
              <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start", marginBottom: 18, gap: 12 }}>
                <div>
                  <h2 style={{ fontSize: 18, fontWeight: 700, color: "#e2e8f0" }}>{selected.name}</h2>
                  <div style={{ fontSize: 12, color: "#334155", marginTop: 2 }}>ID: <span style={{ fontFamily: "monospace", color: "#475569" }}>{selected.id}</span></div>
                </div>
                <button className="btn" onClick={() => setSelected(null)} style={{ padding: "5px 10px", borderRadius: 8, background: "rgba(255,255,255,.05)", border: "1px solid rgba(255,255,255,.1)", color: "#94a3b8", fontSize: 16, minHeight: 32, transform: "none" }}>âœ•</button>
              </div>
              {isMember && scoreList.length > 1 && (
                <div style={{ display: "grid", gridTemplateColumns: "repeat(3,1fr)", gap: 8, marginBottom: 18 }}>
                  {[["à¸—à¸³à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”", scoreList.length + " à¸„à¸£à¸±à¹‰à¸‡", "#60a5fa"], ["à¸ªà¸¹à¸‡à¸ªà¸¸à¸”", best + "%", "#34d399"], ["à¹€à¸‰à¸¥à¸µà¹ˆà¸¢", avg + "%", "#fbbf24"]].map(([l, v, c]) => (
                    <div key={l} style={{ background: "rgba(255,255,255,.03)", border: "1px solid rgba(255,255,255,.07)", borderRadius: 10, padding: "12px", textAlign: "center" }}>
                      <div style={{ fontFamily: "'Crimson Pro',serif", fontSize: 20, fontWeight: 700, color: c }}>{v}</div>
                      <div style={{ fontSize: 10, color: "#334155", marginTop: 2 }}>{l}</div>
                    </div>
                  ))}
                </div>
              )}
              <div style={{ fontSize: 11, color: "#334155", fontWeight: 700, letterSpacing: ".07em", textTransform: "uppercase", marginBottom: 10 }}>à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸„à¸°à¹à¸™à¸™</div>
              <div style={{ display: "flex", flexDirection: "column", gap: 8 }}>
                {scoreList.map((r, i) => {
                  const pc = r.pct >= 80 ? "#34d399" : r.pct >= 60 ? "#fbbf24" : "#f87171";
                  return (
                    <div key={i} style={{ background: "rgba(255,255,255,.02)", border: "1px solid rgba(255,255,255,.05)", borderRadius: 10, padding: "12px 14px" }}>
                      <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between", marginBottom: 6, gap: 8 }}>
                        <span style={{ fontSize: 11, color: "#475569" }}>{new Date(r.date).toLocaleDateString("th-TH", { day: "2-digit", month: "short", year: "2-digit" })} {new Date(r.date).toLocaleTimeString("th-TH", { hour: "2-digit", minute: "2-digit" })}</span>
                        <div style={{ display: "flex", alignItems: "center", gap: 8 }}>
                          <span style={{ fontFamily: "'Crimson Pro',serif", fontSize: 22, fontWeight: 700, color: pc }}>{r.pct}%</span>
                          <span style={{ fontSize: 11, color: "#334155" }}>{r.score}/{r.total}</span>
                          <button className="btn" onClick={() => setDelConfirm({ key: r._fbKey, name: r.name, pct: r.pct })} style={{ padding: "3px 8px", borderRadius: 6, background: "rgba(248,113,113,.08)", border: "1px solid rgba(248,113,113,.2)", color: "#f87171", fontSize: 10, minHeight: 24, transform: "none" }}>à¸¥à¸š</button>
                        </div>
                      </div>
                      <div style={{ display: "flex", gap: 5, flexWrap: "wrap" }}>
                        {r.topicScores && Object.entries(r.topicScores).map(([t, s]) => { const cfg = TC[t] || {}; const p = Math.round(s.ok / s.total * 100); return <span key={t} style={{ fontSize: 9, padding: "2px 6px", borderRadius: 4, background: cfg.bg, border: `1px solid ${cfg.bd}`, color: cfg.c, fontWeight: 700 }}>{cfg.icon} {t} {p}%</span>; })}
                        {r.avgTime && <span style={{ fontSize: 9, padding: "2px 6px", borderRadius: 4, background: "rgba(96,165,250,.08)", border: "1px solid rgba(96,165,250,.2)", color: "#60a5fa", fontWeight: 700 }}>â± {r.avgTime}s/à¸‚à¹‰à¸­</span>}
                      </div>
                    </div>
                  );
                })}
              </div>
            </div>
          </div>
        );
      })()}

      {/* Delete score confirm */}
      {delConfirm && (
        <div onClick={() => setDelConfirm(null)} style={{ position: "fixed", inset: 0, background: "rgba(0,0,0,.8)", zIndex: 960, display: "flex", alignItems: "center", justifyContent: "center", padding: 24 }}>
          <div onClick={e => e.stopPropagation()} className="si" style={{ background: "#131720", border: "1px solid rgba(255,255,255,.1)", borderRadius: 16, padding: 28, maxWidth: 360, width: "100%" }}>
            <h3 style={{ fontSize: 17, fontWeight: 700, color: "#e2e8f0", marginBottom: 10 }}>à¸¢à¸·à¸™à¸¢à¸±à¸™à¸à¸²à¸£à¸¥à¸š</h3>
            <p style={{ fontSize: 14, color: "#94a3b8", lineHeight: 1.7 }}>à¸¥à¸šà¸„à¸°à¹à¸™à¸™ <strong style={{ color: "#e2e8f0" }}>{delConfirm.name}</strong> ({delConfirm.pct}%)?</p>
            <div style={{ display: "flex", gap: 10, marginTop: 20 }}>
              <button className="btn" onClick={() => setDelConfirm(null)} style={{ flex: 1, padding: "10px", borderRadius: 10, background: "rgba(255,255,255,.05)", border: "1px solid rgba(255,255,255,.1)", color: "#94a3b8", fontFamily: "'Noto Sans Thai',serif", transform: "none" }}>à¸¢à¸à¹€à¸¥à¸´à¸</button>
              <button className="btn" onClick={() => delScore(delConfirm.key)} style={{ flex: 1, padding: "10px", borderRadius: 10, background: "rgba(248,113,113,.15)", border: "1px solid rgba(248,113,113,.3)", color: "#f87171", fontFamily: "'Noto Sans Thai',serif", fontWeight: 700, transform: "none" }}>à¸¥à¸š</button>
            </div>
          </div>
        </div>
      )}

      {/* Delete account confirm */}
      {acctDelConfirm && (
        <div onClick={() => setAcctDelConfirm(null)} style={{ position: "fixed", inset: 0, background: "rgba(0,0,0,.8)", zIndex: 960, display: "flex", alignItems: "center", justifyContent: "center", padding: 24 }}>
          <div onClick={e => e.stopPropagation()} className="si" style={{ background: "#131720", border: "1px solid rgba(255,255,255,.1)", borderRadius: 16, padding: 28, maxWidth: 360, width: "100%" }}>
            <h3 style={{ fontSize: 17, fontWeight: 700, color: "#e2e8f0", marginBottom: 10 }}>à¸¢à¸·à¸™à¸¢à¸±à¸™à¸¥à¸šà¸šà¸±à¸à¸Šà¸µ</h3>
            <p style={{ fontSize: 14, color: "#94a3b8", lineHeight: 1.7 }}>à¸¥à¸šà¸šà¸±à¸à¸Šà¸µ <strong style={{ color: "#e2e8f0" }}>{acctDelConfirm.name}</strong> (ID: {acctDelConfirm.id})?</p>
            <p style={{ fontSize: 12, color: "#475569", marginTop: 6 }}>à¸ªà¸¡à¸²à¸Šà¸´à¸à¸ˆà¸°à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸šà¹„à¸”à¹‰à¸­à¸µà¸</p>
            <div style={{ display: "flex", gap: 10, marginTop: 20 }}>
              <button className="btn" onClick={() => setAcctDelConfirm(null)} style={{ flex: 1, padding: "10px", borderRadius: 10, background: "rgba(255,255,255,.05)", border: "1px solid rgba(255,255,255,.1)", color: "#94a3b8", fontFamily: "'Noto Sans Thai',serif", transform: "none" }}>à¸¢à¸à¹€à¸¥à¸´à¸</button>
              <button className="btn" onClick={() => deleteAccount(acctDelConfirm.id)} style={{ flex: 1, padding: "10px", borderRadius: 10, background: "rgba(248,113,113,.15)", border: "1px solid rgba(248,113,113,.3)", color: "#f87171", fontFamily: "'Noto Sans Thai',serif", fontWeight: 700, transform: "none" }}>à¸¥à¸šà¸šà¸±à¸à¸Šà¸µ</button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MEMBER HOME
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function MemberHome({ user, onStart, onLogout, myScores, generating, apiKey, onApiKeyChange }) {
  const { isMobile } = useBreakpoint();
  const [showKey, setShowKey] = useState(false);

  // Loading overlay while AI generates questions
  if (generating) {
    return (
      <div style={{ minHeight: "100dvh", background: "#0c1018", fontFamily: "'Noto Sans Thai','Crimson Pro',serif", color: "white", display: "flex", alignItems: "center", justifyContent: "center" }}>
        <style>{CSS}</style>
        <div className="fu" style={{ textAlign: "center", maxWidth: 400, padding: 40 }}>
          <div style={{ width: 80, height: 80, borderRadius: 24, background: "linear-gradient(135deg,rgba(96,165,250,.18),rgba(168,85,247,.18))", border: "1px solid rgba(96,165,250,.28)", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 36, margin: "0 auto 24px", animation: "pulse 2s ease infinite" }}>ğŸ¤–</div>
          <h2 style={{ fontFamily: "'Crimson Pro',serif", fontSize: "clamp(20px,5vw,26px)", fontWeight: 700, color: "#e2e8f0", marginBottom: 10 }}>AI à¸à¸³à¸¥à¸±à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¸„à¸³à¸–à¸²à¸¡...</h2>
          <p style={{ color: "#475569", fontSize: 14, lineHeight: 1.7, marginBottom: 20 }}>à¸à¸³à¸¥à¸±à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¸„à¸³à¸–à¸²à¸¡à¹ƒà¸«à¸¡à¹ˆ 50 à¸‚à¹‰à¸­<br />à¹‚à¸›à¸£à¸”à¸£à¸­à¸ªà¸±à¸à¸„à¸£à¸¹à¹ˆ</p>
          <div style={{ display: "flex", justifyContent: "center", gap: 6 }}>
            {[0, 1, 2].map(i => (
              <div key={i} style={{ width: 10, height: 10, borderRadius: "50%", background: "#3b82f6", animation: `pulse 1.2s ease ${i * 0.2}s infinite` }} />
            ))}
          </div>
          <div style={{ marginTop: 24, display: "flex", gap: 8, justifyContent: "center", flexWrap: "wrap" }}>
            {Object.entries(TC).map(([topic, cfg]) => (
              <span key={topic} style={{ fontSize: 11, padding: "4px 10px", borderRadius: 6, background: cfg.bg, border: `1px solid ${cfg.bd}`, color: cfg.c, fontWeight: 700 }}>{cfg.icon} {topic}</span>
            ))}
          </div>
        </div>
      </div>
    );
  }

  return (
    <div style={{ minHeight: "100dvh", background: "#0c1018", fontFamily: "'Noto Sans Thai','Crimson Pro',serif", color: "white" }}>
      <style>{CSS}</style>
      <div style={{ borderBottom: "1px solid rgba(255,255,255,.06)", padding: "0 clamp(14px,4vw,32px)", display: "flex", alignItems: "center", justifyContent: "space-between", height: 56, background: "rgba(12,16,24,.95)", backdropFilter: "blur(12px)", position: "sticky", top: 0, zIndex: 10, gap: 12 }}>
        <div style={{ display: "flex", alignItems: "center", gap: 10, minWidth: 0 }}>
          <span style={{ fontSize: 16 }}>ğŸ”¬</span>
          <span style={{ fontFamily: "'Crimson Pro',serif", fontSize: "clamp(13px,3vw,17px)", fontWeight: 700, color: "#e2e8f0", overflow: "hidden", textOverflow: "ellipsis", whiteSpace: "nowrap" }}>Science Quiz</span>
        </div>
        <div style={{ display: "flex", alignItems: "center", gap: 10, flexShrink: 0 }}>
          <span style={{ fontSize: 13, color: "#475569" }}>à¸ªà¸§à¸±à¸ªà¸”à¸µ, <span style={{ color: "#93c5fd", fontWeight: 600 }}>{user.name}</span></span>
          <button className="btn" onClick={onLogout} style={{ padding: "6px 12px", borderRadius: 8, background: "rgba(255,255,255,.05)", border: "1px solid rgba(255,255,255,.09)", color: "#475569", fontSize: 12, fontFamily: "'Noto Sans Thai',serif", transform: "none" }}>à¸­à¸­à¸</button>
        </div>
      </div>
      <div style={{ maxWidth: 700, margin: "0 auto", padding: "clamp(20px,4vw,40px) clamp(14px,4vw,32px)" }}>
        {/* Hero */}
        <div className="fu" style={{ background: "rgba(255,255,255,.025)", border: "1px solid rgba(255,255,255,.07)", borderRadius: 20, padding: "clamp(24px,5vw,40px)", marginBottom: 24, textAlign: "center" }}>
          <div style={{ fontFamily: "'Crimson Pro',serif", fontSize: "clamp(28px,6vw,40px)", fontWeight: 700, lineHeight: 1.2, marginBottom: 12 }}>
            <span style={{ background: "linear-gradient(135deg,#e2e8f0,#94a3b8)", WebkitBackgroundClip: "text", WebkitTextFillColor: "transparent" }}>à¸à¸£à¹‰à¸­à¸¡à¸ªà¸­à¸š</span>
          </div>
          <p style={{ color: "#334155", fontSize: "clamp(13px,2.5vw,15px)", marginBottom: 8 }}>ğŸ¤– AI à¸ªà¸£à¹‰à¸²à¸‡à¸„à¸³à¸–à¸²à¸¡à¹ƒà¸«à¸¡à¹ˆ 50 à¸‚à¹‰à¸­à¸—à¸¸à¸à¸„à¸£à¸±à¹‰à¸‡ Â· à¸ˆà¸±à¸šà¹€à¸§à¸¥à¸² 30 à¸§à¸´à¸™à¸²à¸—à¸µ/à¸‚à¹‰à¸­</p>
          <p style={{ color: "#1e293b", fontSize: 11, marginBottom: 16 }}>Powered by Google Gemini AI (à¸Ÿà¸£à¸µ!)</p>

          {/* Gemini API Key Input */}
          <div style={{ background: "rgba(255,255,255,.03)", border: "1px solid rgba(255,255,255,.08)", borderRadius: 14, padding: "16px 18px", marginBottom: 20, textAlign: "left" }}>
            <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between", marginBottom: 8 }}>
              <label style={{ fontSize: 10, color: "#475569", fontWeight: 700, letterSpacing: ".08em", textTransform: "uppercase" }}>ğŸ”‘ Gemini API Key</label>
              {apiKey && <span style={{ fontSize: 9, padding: "2px 8px", borderRadius: 5, background: "rgba(52,211,153,.1)", border: "1px solid rgba(52,211,153,.25)", color: "#34d399", fontWeight: 700 }}>âœ“ à¸à¸£à¹‰à¸­à¸¡à¹ƒà¸Šà¹‰à¸‡à¸²à¸™</span>}
            </div>
            <div style={{ display: "flex", gap: 8, alignItems: "center" }}>
              <input
                type={showKey ? "text" : "password"}
                value={apiKey}
                onChange={e => onApiKeyChange(e.target.value)}
                placeholder="à¸§à¸²à¸‡ Gemini API Key à¸—à¸µà¹ˆà¸™à¸µà¹ˆ..."
                style={{ flex: 1, padding: "10px 14px", borderRadius: 10, background: "rgba(255,255,255,.04)", border: "1px solid rgba(255,255,255,.1)", color: "white", fontSize: 12, fontFamily: "monospace" }}
              />
              <button className="btn" onClick={() => setShowKey(p => !p)} style={{ padding: "8px 10px", borderRadius: 8, background: "rgba(255,255,255,.05)", border: "1px solid rgba(255,255,255,.1)", color: "#475569", fontSize: 12, minHeight: 36, transform: "none" }}>{showKey ? "ğŸ™ˆ" : "ğŸ‘ï¸"}</button>
            </div>
            {!apiKey && <p style={{ fontSize: 11, color: "#334155", marginTop: 8, lineHeight: 1.6 }}>à¸Ÿà¸£à¸µ! à¸£à¸±à¸š Key à¸—à¸µà¹ˆ <a href="https://aistudio.google.com/apikey" target="_blank" rel="noopener" style={{ color: "#60a5fa", textDecoration: "underline" }}>aistudio.google.com/apikey</a></p>}
            {!apiKey && <p style={{ fontSize: 10, color: "#1e293b", marginTop: 4 }}>à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸¡à¸µ Key à¸ˆà¸°à¹ƒà¸Šà¹‰à¸„à¸³à¸–à¸²à¸¡à¸ªà¸³à¹€à¸£à¹‡à¸ˆà¸£à¸¹à¸›à¹à¸—à¸™</p>}
          </div>

          <div style={{ display: "grid", gridTemplateColumns: "repeat(3,1fr)", gap: 10, marginBottom: 28 }}>
            {Object.entries(TC).map(([topic, cfg]) => (
              <div key={topic} style={{ background: cfg.bg, border: `1px solid ${cfg.bd}`, borderRadius: 12, padding: "14px 10px" }}>
                <div style={{ fontSize: 22, marginBottom: 4 }}>{cfg.icon}</div>
                <div style={{ fontSize: 12, color: cfg.c, fontWeight: 700 }}>{topic}</div>
              </div>
            ))}
          </div>
          <button className="btn" onClick={onStart} style={{ padding: "14px 40px", borderRadius: 14, background: apiKey ? "linear-gradient(135deg,#3b82f6,#1d4ed8)" : "linear-gradient(135deg,#475569,#334155)", color: "white", fontSize: 16, fontWeight: 700, fontFamily: "'Noto Sans Thai',serif", transform: "none" }}>
            {apiKey ? "ğŸ¤– à¹€à¸£à¸´à¹ˆà¸¡à¸—à¸³à¸‚à¹‰à¸­à¸ªà¸­à¸š (AI) â†’" : "ğŸ“ à¹€à¸£à¸´à¹ˆà¸¡à¸—à¸³à¸‚à¹‰à¸­à¸ªà¸­à¸š â†’"}
          </button>
        </div>
        {/* History */}
        {myScores.length > 0 && (
          <div className="fu" style={{ animationDelay: ".1s" }}>
            <h3 style={{ fontSize: 11, color: "#334155", letterSpacing: ".08em", textTransform: "uppercase", fontWeight: 700, marginBottom: 12 }}>à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸¥à¹ˆà¸²à¸ªà¸¸à¸”</h3>
            <div style={{ display: "flex", flexDirection: "column", gap: 8 }}>
              {myScores.slice(0, 5).map((s, i) => {
                const pc = s.pct >= 80 ? "#34d399" : s.pct >= 60 ? "#fbbf24" : "#f87171";
                return (
                  <div key={i} style={{ background: "rgba(255,255,255,.025)", border: "1px solid rgba(255,255,255,.06)", borderRadius: 12, padding: "12px 16px", display: "flex", alignItems: "center", justifyContent: "space-between", gap: 12 }}>
                    <div><div style={{ fontSize: 13, color: "#94a3b8" }}>{new Date(s.date).toLocaleDateString("th-TH", { day: "2-digit", month: "short" })}</div></div>
                    <div style={{ display: "flex", gap: 6, flexWrap: "wrap" }}>
                      {s.topicScores && Object.entries(s.topicScores).map(([t, ts]) => { const cfg = TC[t] || {}; const p = Math.round(ts.ok / ts.total * 100); return <span key={t} style={{ fontSize: 10, padding: "2px 6px", borderRadius: 4, background: cfg.bg, border: `1px solid ${cfg.bd}`, color: cfg.c, fontWeight: 700 }}>{cfg.icon} {p}%</span>; })}
                    </div>
                    <div style={{ textAlign: "right", flexShrink: 0 }}>
                      <span style={{ fontFamily: "'Crimson Pro',serif", fontSize: 22, fontWeight: 700, color: pc }}>{s.pct}%</span>
                      <div style={{ fontSize: 10, color: "#334155" }}>{s.score}/{s.total}</div>
                    </div>
                  </div>
                );
              })}
            </div>
          </div>
        )}
      </div>
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  QUIZ SCREEN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function QuizScreen({ user, questions, onFinish }) {
  const { isMobile } = useBreakpoint();
  const [idx, setIdx] = useState(0);
  const [selected, setSelected] = useState(null);
  const [revealed, setRevealed] = useState(false);
  const [showExp, setShowExp] = useState(false);
  const [answers, setAnswers] = useState([]);
  const [timeLeft, setTimeLeft] = useState(TIMER_SECS);
  const [activeTerm, setActiveTerm] = useState(null);
  const timerRef = useRef(null);
  const revealRef = useRef(false);

  const q = questions[idx];
  const cfg = TC[q?.topic] || {};
  const tc = timeLeft > 15 ? "#34d399" : timeLeft > 7 ? "#fbbf24" : "#f87171";
  const labels = ["à¸", "à¸‚", "à¸„", "à¸‡"];

  const doAnswer = useCallback((i) => {
    if (revealRef.current) return;
    revealRef.current = true;
    if (timerRef.current) { clearInterval(timerRef.current); timerRef.current = null; }
    setSelected(i); setRevealed(true);
    const ok = i !== null && i === q?.ans;
    setAnswers(prev => [...prev, { sel: i, ok, time: TIMER_SECS - timeLeft }]);
  }, [q, timeLeft]);

  useEffect(() => {
    revealRef.current = false; setTimeLeft(TIMER_SECS);
    if (timerRef.current) clearInterval(timerRef.current);
    timerRef.current = setInterval(() => { setTimeLeft(p => { if (p <= 1) { clearInterval(timerRef.current); timerRef.current = null; return 0; } return p - 1; }); }, 1000);
    return () => { if (timerRef.current) { clearInterval(timerRef.current); timerRef.current = null; } };
  }, [idx]);
  useEffect(() => { if (timeLeft === 0 && !revealRef.current) doAnswer(null); }, [timeLeft]);

  const nextQ = () => {
    if (idx + 1 >= questions.length) { onFinish([...answers]); return; }
    setIdx(i => i + 1); setSelected(null); setRevealed(false); setShowExp(false); setActiveTerm(null);
  };
  if (!q) return null;

  const DotMap = () => (
    <div style={{ display: "flex", flexWrap: "wrap", gap: 5, justifyContent: "center", padding: "10px 16px", background: "rgba(255,255,255,.02)", borderBottom: "1px solid rgba(255,255,255,.05)" }}>
      {questions.map((_, i) => {
        const a = answers[i]; const cur = i === idx;
        let bg = "rgba(255,255,255,.06)", bd = "rgba(255,255,255,.1)", col = "#334155";
        if (cur) { bg = "rgba(96,165,250,.2)"; bd = "rgba(96,165,250,.5)"; col = "#60a5fa"; }
        else if (a?.ok) { bg = "rgba(52,211,153,.15)"; bd = "rgba(52,211,153,.3)"; col = "#34d399"; }
        else if (a && !a.ok) { bg = "rgba(248,113,113,.15)"; bd = "rgba(248,113,113,.3)"; col = "#f87171"; }
        return <div key={i} style={{ width: 22, height: 22, borderRadius: 6, background: bg, border: `1px solid ${bd}`, display: "flex", alignItems: "center", justifyContent: "center", fontSize: 9, fontWeight: 700, color: col }}>{i + 1}</div>;
      })}
    </div>
  );

  return (
    <div style={{ height: "100dvh", background: "#0c1018", fontFamily: "'Noto Sans Thai','Crimson Pro',serif", color: "white", display: "flex", flexDirection: "column", overflow: "hidden" }}>
      <style>{CSS}</style>
      {/* Topbar */}
      <div style={{ display: "flex", alignItems: "center", gap: 10, padding: "0 clamp(10px,2vw,20px)", height: isMobile ? 50 : 54, borderBottom: "1px solid rgba(255,255,255,.06)", background: "rgba(12,16,24,.95)", backdropFilter: "blur(12px)", flexShrink: 0, zIndex: 5 }}>
        <Ring progress={timeLeft / TIMER_SECS} color={tc} size={isMobile ? 40 : 48} stroke={3} />
        <span style={{ fontFamily: "'Crimson Pro',serif", fontSize: "clamp(20px,4vw,26px)", fontWeight: 700, color: tc, minWidth: "2ch", textAlign: "center" }}>{timeLeft}</span>
        <div style={{ flex: 1, minWidth: 0 }}>
          <div style={{ height: 3, background: "rgba(255,255,255,.06)", borderRadius: 99, overflow: "hidden" }}>
            <div style={{ height: "100%", width: ((idx + 1) / questions.length * 100) + "%", background: "linear-gradient(90deg,#3b82f6,#60a5fa)", borderRadius: 99, transition: "width .3s ease" }} />
          </div>
          <div style={{ fontSize: 10, color: "#334155", marginTop: 3 }}>{idx + 1} / {questions.length}</div>
        </div>
        <div style={{ display: "flex", alignItems: "center", gap: 5, flexShrink: 0 }}>
          <span style={{ fontSize: 9, padding: "2px 7px", borderRadius: 5, background: cfg.bg, border: `1px solid ${cfg.bd}`, color: cfg.c, fontWeight: 700 }}>{cfg.icon} {q.topic}</span>
          <span style={{ fontSize: 11, color: "#34d399", fontWeight: 700 }}>{answers.filter(a => a.ok).length}âœ“</span>
        </div>
      </div>

      {isMobile && <DotMap />}

      <div className="quiz-layout" style={{ flex: 1, display: "flex", overflow: "hidden", gap: 0 }}>
        {/* Question area */}
        <div style={{ flex: 1, overflowY: "auto", padding: "clamp(14px,3vw,28px)" }}>
          <div style={{ marginBottom: 18 }}>
            <p style={{ fontSize: "clamp(14px,2.5vw,17px)", fontWeight: 600, color: "#e2e8f0", lineHeight: 1.85 }}>
              <span style={{ fontFamily: "'Crimson Pro',serif", fontSize: "clamp(16px,3vw,20px)", fontWeight: 700, color: "#60a5fa", marginRight: 10 }}>{idx + 1}.</span>
              <Tx text={q.q} onTerm={setActiveTerm} />
            </p>
          </div>
          <div style={{ display: "flex", flexDirection: "column", gap: 10, marginBottom: 18 }}>
            {q.opts.map((opt, i) => {
              let bg = "rgba(255,255,255,.03)", bd = "rgba(255,255,255,.08)", col = "#cbd5e1";
              if (revealed) {
                if (i === q.ans) { bg = "rgba(52,211,153,.12)"; bd = "rgba(52,211,153,.35)"; col = "#34d399"; }
                else if (i === selected && i !== q.ans) { bg = "rgba(248,113,113,.1)"; bd = "rgba(248,113,113,.3)"; col = "#f87171"; }
                else { col = "#334155"; }
              }
              return (
                <button key={i} className="opt" onClick={() => !revealed && doAnswer(i)} disabled={revealed}
                  style={{ background: bg, border: `1px solid ${bd}`, borderRadius: 12, padding: "13px 16px", color: col, fontSize: "clamp(13px,2vw,15px)", fontFamily: "'Noto Sans Thai',serif", display: "flex", alignItems: "center", gap: 12 }}>
                  <span style={{ width: 26, height: 26, borderRadius: 7, background: "rgba(255,255,255,.05)", border: "1px solid rgba(255,255,255,.1)", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 11, fontWeight: 700, color: "#475569", flexShrink: 0 }}>{labels[i]}</span>
                  <Tx text={opt} onTerm={setActiveTerm} />
                  {revealed && i === q.ans && <span style={{ marginLeft: "auto", fontSize: 16, flexShrink: 0 }}>âœ“</span>}
                  {revealed && i === selected && i !== q.ans && <span style={{ marginLeft: "auto", fontSize: 14, flexShrink: 0 }}>âœ—</span>}
                </button>
              );
            })}
          </div>
          {revealed && (
            <div className="fi" style={{ marginBottom: 18 }}>
              <button className="btn" onClick={() => setShowExp(p => !p)} style={{ padding: "8px 14px", borderRadius: 9, background: "rgba(251,191,36,.08)", border: "1px solid rgba(251,191,36,.2)", color: "#fbbf24", fontSize: 12, fontFamily: "'Noto Sans Thai',serif", transform: "none", marginBottom: 8 }}>
                {showExp ? "â–² à¸‹à¹ˆà¸­à¸™à¸„à¸³à¸­à¸˜à¸´à¸šà¸²à¸¢" : "ğŸ’¡ à¸”à¸¹à¸„à¸³à¸­à¸˜à¸´à¸šà¸²à¸¢"}
              </button>
              {showExp && <div style={{ background: "rgba(255,255,255,.02)", border: "1px solid rgba(255,255,255,.05)", borderRadius: 12, padding: "12px 16px" }}>
                <p style={{ fontSize: "clamp(12px,2vw,13px)", color: "#64748b", lineHeight: 1.85 }}><Tx text={q.exp} onTerm={setActiveTerm} /></p>
              </div>}
              <button className="btn" onClick={nextQ} style={{ width: "100%", marginTop: 10, padding: "13px", borderRadius: 12, background: idx + 1 >= questions.length ? "linear-gradient(135deg,#34d399,#059669)" : "linear-gradient(135deg,#3b82f6,#1d4ed8)", color: "white", fontSize: 14, fontWeight: 700, fontFamily: "'Noto Sans Thai',serif", transform: "none" }}>
                {idx + 1 >= questions.length ? "à¸”à¸¹à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œ â†’" : "à¸‚à¹‰à¸­à¸–à¸±à¸”à¹„à¸› â†’"}
              </button>
            </div>
          )}
        </div>

        {/* Sidebar (desktop) */}
        {!isMobile && (
          <div className="sidebar-q" style={{ width: 190, borderLeft: "1px solid rgba(255,255,255,.06)", padding: "16px 10px", overflowY: "auto", display: "flex", flexDirection: "column", gap: 4, flexShrink: 0 }}>
            <div style={{ fontSize: 10, color: "#334155", fontWeight: 700, letterSpacing: ".06em", textTransform: "uppercase", marginBottom: 6, paddingLeft: 4 }}>à¸‚à¹‰à¸­à¸—à¸µà¹ˆ</div>
            <div style={{ display: "grid", gridTemplateColumns: "repeat(5,1fr)", gap: 4 }}>
              {questions.map((_, i) => {
                const a = answers[i]; const cur = i === idx;
                let bg = "rgba(255,255,255,.04)", bd = "rgba(255,255,255,.08)", col = "#334155";
                if (cur) { bg = "rgba(96,165,250,.18)"; bd = "rgba(96,165,250,.45)"; col = "#60a5fa"; }
                else if (a?.ok) { bg = "rgba(52,211,153,.12)"; bd = "rgba(52,211,153,.3)"; col = "#34d399"; }
                else if (a && !a.ok) { bg = "rgba(248,113,113,.1)"; bd = "rgba(248,113,113,.28)"; col = "#f87171"; }
                return <div key={i} style={{ aspectRatio: "1", display: "flex", alignItems: "center", justifyContent: "center", background: bg, border: `1px solid ${bd}`, borderRadius: 6, fontSize: 9, fontWeight: 700, color: col }}>{i + 1}</div>;
              })}
            </div>
            <div style={{ marginTop: "auto", display: "flex", flexDirection: "column", gap: 5, fontSize: 10, color: "#334155" }}>
              {[["rgba(52,211,153,.1)", "rgba(52,211,153,.28)", "#34d399", "à¸–à¸¹à¸"], ["rgba(248,113,113,.1)", "rgba(248,113,113,.28)", "#f87171", "à¸œà¸´à¸”"], ["rgba(96,165,250,.18)", "rgba(96,165,250,.45)", "#60a5fa", "à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™"]].map(([b, bd, c, l]) => (
                <div key={l} style={{ display: "flex", alignItems: "center", gap: 6 }}><div style={{ width: 12, height: 12, borderRadius: 3, background: b, border: `1px solid ${bd}` }} /><span style={{ color: c }}>{l}</span></div>
              ))}
            </div>
          </div>
        )}
      </div>
      <GlossaryModal term={activeTerm} onClose={() => setActiveTerm(null)} isMobile={isMobile} />
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  RESULTS SCREEN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function ResultsScreen({ user, questions, answers, onRetry, onHome }) {
  const { isMobile, isDesktop } = useBreakpoint();
  const [activeTerm, setActiveTerm] = useState(null);
  const [filter, setFilter] = useState("all");

  const score = answers.filter(a => a.ok).length;
  const total = questions.length;
  const pct = Math.round(score / total * 100);
  const avgT = answers.length ? Math.round(answers.reduce((s, a) => s + a.time, 0) / answers.length) : 0;
  const [grade, gc] = pct >= 90 ? ["à¸¢à¸­à¸”à¹€à¸¢à¸µà¹ˆà¸¢à¸¡ ğŸ†", "#34d399"] : pct >= 75 ? ["à¸”à¸µà¹€à¸¢à¸µà¹ˆà¸¢à¸¡ ğŸŒŸ", "#60a5fa"] : pct >= 60 ? ["à¸”à¸µà¸¡à¸²à¸ ğŸ‘", "#fbbf24"] : pct >= 40 ? ["à¸à¸­à¹ƒà¸Šà¹‰ ğŸ“š", "#fb923c"] : ["à¸•à¹‰à¸­à¸‡à¸—à¸šà¸—à¸§à¸™ ğŸ’ª", "#f87171"];

  const topicScores = {};
  questions.forEach((q, i) => {
    if (!topicScores[q.topic]) topicScores[q.topic] = { ok: 0, total: 0 };
    topicScores[q.topic].total++;
    if (answers[i]?.ok) topicScores[q.topic].ok++;
  });

  const filtered = questions.map((q, i) => ({ q, a: answers[i], i })).filter(({ a }) => filter === "all" ? true : filter === "wrong" ? !a?.ok : a?.ok);

  const SummaryCard = () => (
    <div style={{ background: "rgba(255,255,255,.03)", border: "1px solid rgba(255,255,255,.07)", borderRadius: 18, padding: "clamp(20px,4vw,28px) clamp(16px,3vw,24px)" }}>
      <div style={{ textAlign: "center", marginBottom: 20, paddingBottom: 16, borderBottom: "1px solid rgba(255,255,255,.06)" }}>
        <div style={{ fontSize: 10, color: gc, fontWeight: 700, letterSpacing: ".1em", textTransform: "uppercase", marginBottom: 10 }}>{grade}</div>
        <div style={{ fontFamily: "'Crimson Pro',serif", fontSize: "clamp(56px,12vw,80px)", fontWeight: 700, color: gc, lineHeight: 1 }}>{pct}</div>
        <div style={{ fontFamily: "'Crimson Pro',serif", fontSize: 18, color: `${gc}88`, marginTop: -4 }}>%</div>
        <div style={{ color: "#475569", marginTop: 8, fontSize: 13 }}>à¸–à¸¹à¸ {score} à¸ˆà¸²à¸ {total} à¸‚à¹‰à¸­</div>
      </div>
      <div style={{ display: "grid", gridTemplateColumns: "repeat(2,1fr)", gap: 8, marginBottom: 16 }}>
        {[["â±", avgT + "s", "à¹€à¸§à¸¥à¸²/à¸‚à¹‰à¸­"], ["âœ“", score, "à¸–à¸¹à¸"], ["âœ—", total - score, "à¸œà¸´à¸”"], ["ğŸ”¥", answers.filter(a => a.time <= 10).length, "à¹€à¸£à¹‡à¸§â‰¤10s"]].map(([icon, val, label]) => (
          <div key={label} style={{ background: "rgba(255,255,255,.03)", border: "1px solid rgba(255,255,255,.06)", borderRadius: 10, padding: "10px", textAlign: "center" }}>
            <div style={{ fontSize: 14 }}>{icon}</div>
            <div style={{ fontFamily: "'Crimson Pro',serif", fontSize: 20, fontWeight: 700, color: "#e2e8f0", marginTop: 3 }}>{val}</div>
            <div style={{ fontSize: 9, color: "#334155", marginTop: 1 }}>{label}</div>
          </div>
        ))}
      </div>
      {/* Topic breakdown */}
      {Object.entries(topicScores).map(([topic, { ok, total: t }]) => {
        const cfg = TC[topic] || {}; const p = Math.round(ok / t * 100);
        return (<div key={topic} style={{ marginBottom: 10 }}>
          <div style={{ display: "flex", justifyContent: "space-between", marginBottom: 4 }}><span style={{ fontSize: 12, color: cfg.c, fontWeight: 600 }}>{cfg.icon} {topic}</span><span style={{ fontSize: 11, color: "#475569" }}>{ok}/{t} ({p}%)</span></div>
          <div style={{ height: 4, background: "rgba(255,255,255,.05)", borderRadius: 99 }}><div style={{ height: "100%", width: p + "%", background: `linear-gradient(90deg,${cfg.c},${cfg.c}66)`, borderRadius: 99, transition: "width 1s ease" }} /></div>
        </div>);
      })}

      {/* Firebase auto-sync notice */}
      <div style={{ marginTop: 16, background: "rgba(52,211,153,.06)", border: "1px solid rgba(52,211,153,.18)", borderRadius: 12, padding: "14px 14px 12px" }}>
        <div style={{ fontSize: 10, color: "#34d399", fontWeight: 700, letterSpacing: ".07em", textTransform: "uppercase", marginBottom: 6, display: "flex", alignItems: "center", gap: 6 }}>
          â˜ï¸ Real-Time Sync
        </div>
        <p style={{ fontSize: 12, color: "#475569", lineHeight: 1.6 }}>à¸„à¸°à¹à¸™à¸™à¸‚à¸­à¸‡à¸„à¸¸à¸“à¸–à¸¹à¸à¸šà¸±à¸™à¸—à¸¶à¸à¹à¸¥à¸°à¸ªà¹ˆà¸‡à¸–à¸¶à¸‡ Admin à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´à¹à¸¥à¹‰à¸§ âœ”ï¸</p>
      </div>

      <div style={{ display: "flex", gap: 10, marginTop: 14 }}>
        <button className="btn" onClick={onRetry} style={{ flex: 1, padding: "12px", borderRadius: 11, background: "linear-gradient(135deg,#3b82f6,#1d4ed8)", color: "white", fontSize: 14, fontWeight: 700, fontFamily: "'Noto Sans Thai',serif", transform: "none" }}>à¸—à¸³à¹ƒà¸«à¸¡à¹ˆ</button>
        <button className="btn" onClick={onHome} style={{ flex: 1, padding: "12px", borderRadius: 11, background: "rgba(255,255,255,.05)", border: "1px solid rgba(255,255,255,.09)", color: "#94a3b8", fontSize: 14, fontFamily: "'Noto Sans Thai',serif", transform: "none" }}>à¸«à¸™à¹‰à¸²à¸«à¸¥à¸±à¸</button>
      </div>
    </div>
  );

  return (
    <div style={{ minHeight: "100vh", background: "#0c1018", fontFamily: "'Noto Sans Thai','Crimson Pro',serif", color: "white" }}>
      <style>{CSS}</style>
      <div style={{ borderBottom: "1px solid rgba(255,255,255,.06)", padding: "0 clamp(16px,4vw,40px)", display: "flex", alignItems: "center", justifyContent: "space-between", height: 54, background: "rgba(12,16,24,.92)", backdropFilter: "blur(12px)", position: "sticky", top: 0, zIndex: 10, gap: 12 }}>
        <span style={{ fontFamily: "'Crimson Pro',serif", fontSize: "clamp(14px,3vw,17px)", fontWeight: 700, color: "#e2e8f0" }}>à¸œà¸¥à¹à¸šà¸šà¸—à¸”à¸ªà¸­à¸š</span>
        <div style={{ display: "flex", gap: 8 }}>
          <button className="btn" onClick={onRetry} style={{ padding: "7px clamp(10px,2vw,18px)", borderRadius: 9, background: "rgba(59,130,246,.12)", border: "1px solid rgba(59,130,246,.25)", color: "#60a5fa", fontFamily: "'Noto Sans Thai',serif", fontSize: "clamp(11px,2vw,13px)", fontWeight: 600, transform: "none" }}>à¸—à¸³à¹ƒà¸«à¸¡à¹ˆ</button>
          <button className="btn" onClick={onHome} style={{ padding: "7px clamp(10px,2vw,18px)", borderRadius: 9, background: "rgba(255,255,255,.05)", border: "1px solid rgba(255,255,255,.09)", color: "#94a3b8", fontFamily: "'Noto Sans Thai',serif", fontSize: "clamp(11px,2vw,13px)", transform: "none" }}>à¸«à¸™à¹‰à¸²à¸«à¸¥à¸±à¸</button>
        </div>
      </div>
      <div style={{ maxWidth: isDesktop ? 1000 : 700, margin: "0 auto", padding: "clamp(16px,3vw,32px) clamp(14px,3vw,40px) 60px" }}>
        <div style={{ display: "grid", gridTemplateColumns: isDesktop ? "300px 1fr" : "1fr", gap: 24, alignItems: "start" }}>
          <div style={isDesktop ? { position: "sticky", top: 70 } : {}}><SummaryCard /></div>
          <div>
            <div style={{ display: "flex", gap: 6, marginBottom: 16, flexWrap: "wrap" }}>
              {[["all", `à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” (${total})`], ["wrong", `à¸œà¸´à¸” (${total - score})`], ["correct", `à¸–à¸¹à¸ (${score})`]].map(([v, l]) => (
                <button key={v} className="btn" onClick={() => setFilter(v)} style={{ padding: "7px 14px", borderRadius: 9, background: filter === v ? "rgba(96,165,250,.15)" : "rgba(255,255,255,.04)", border: filter === v ? "1px solid rgba(96,165,250,.3)" : "1px solid rgba(255,255,255,.08)", color: filter === v ? "#93c5fd" : "#475569", fontSize: 12, fontFamily: "'Noto Sans Thai',serif", transform: "none", minHeight: 36 }}>
                  {l}
                </button>
              ))}
            </div>
            <div style={{ display: "flex", flexDirection: "column", gap: 12 }}>
              {filtered.map(({ q, a, i }, filterIndex) => {
                const ok = a?.ok;
                const cfg = TC[q.topic] || {};
                return (
                  <div key={i} className="fu" style={{ background: "rgba(255,255,255,.025)", border: `1px solid ${ok ? "rgba(52,211,153,.12)" : "rgba(248,113,113,.12)"}`, borderRadius: 14, padding: "16px", animationDelay: (filterIndex * 0.02) + "s" }}>
                    <div style={{ display: "flex", gap: 12, alignItems: "flex-start" }}>
                      <span style={{ fontSize: 16, flexShrink: 0, marginTop: 2 }}>{ok ? "âœ…" : "âŒ"}</span>
                      <div style={{ flex: 1, minWidth: 0 }}>
                        <div style={{ display: "flex", alignItems: "center", gap: 6, marginBottom: 6, flexWrap: "wrap" }}>
                          <span style={{ fontSize: 10, color: cfg.c, fontWeight: 700, padding: "2px 7px", borderRadius: 5, background: cfg.bg, border: `1px solid ${cfg.bd}` }}>{cfg.icon} {q.topic}</span>
                          <span style={{ fontSize: 10, color: "#1e293b" }}>à¸‚à¹‰à¸­ {i + 1} Â· {a?.time ?? 0}s</span>
                        </div>
                        <p style={{ fontSize: "clamp(12px,2vw,14px)", fontWeight: 500, color: "#cbd5e1", lineHeight: 1.75, marginBottom: 8 }}><Tx text={q.q} onTerm={setActiveTerm} /></p>
                        <div style={{ marginBottom: 8 }}>
                          <div style={{ display: "flex", gap: 8, alignItems: "flex-start" }}><span style={{ fontSize: 11, color: "#34d399", fontWeight: 700, flexShrink: 0, marginTop: 1 }}>âœ“ à¸–à¸¹à¸:</span><span style={{ fontSize: "clamp(12px,2vw,13px)", color: "#34d399" }}>{q.opts[q.ans]}</span></div>
                          {!ok && a && <div style={{ display: "flex", gap: 8, alignItems: "flex-start", marginTop: 4 }}><span style={{ fontSize: 11, color: "#f87171", fontWeight: 700, flexShrink: 0, marginTop: 1 }}>{a.sel !== null ? "âœ— à¸„à¸¸à¸“à¸•à¸­à¸š:" : "â± à¸«à¸¡à¸”à¹€à¸§à¸¥à¸²"}</span>{a.sel !== null && <span style={{ fontSize: "clamp(12px,2vw,13px)", color: "#f87171" }}>{q.opts[a.sel]}</span>}</div>}
                        </div>
                        <div style={{ background: "rgba(255,255,255,.02)", border: "1px solid rgba(255,255,255,.05)", borderRadius: 10, padding: "10px 14px" }}>
                          <p style={{ fontSize: 10, color: "#60a5fa", fontWeight: 700, marginBottom: 4 }}>ğŸ’¡ à¸„à¸³à¸­à¸˜à¸´à¸šà¸²à¸¢</p>
                          <p style={{ fontSize: "clamp(11px,2vw,12px)", color: "#64748b", lineHeight: 1.8 }}><Tx text={q.exp} onTerm={setActiveTerm} /></p>
                        </div>
                      </div>
                    </div>
                  </div>
                );
              })}
            </div>
          </div>
        </div>
      </div>
      <GlossaryModal term={activeTerm} onClose={() => setActiveTerm(null)} isMobile={isMobile} />
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MAIN APP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
export default function App() {
  const [user, setUser] = useState(null);
  const [view, setView] = useState("home");
  const [questions, setQuestions] = useState([]);
  const [answers, setAnswers] = useState([]);
  const [myScores, setMyScores] = useState([]);
  const [generating, setGenerating] = useState(false);
  const [geminiKey, setGeminiKey] = useState(() => {
    try { return localStorage.getItem("sq_gemini_key") || "AIzaSyCHT4XZvomyZ095b9QaBevWFr1JNS4IvgM"; } catch { return "AIzaSyCHT4XZvomyZ095b9QaBevWFr1JNS4IvgM"; }
  });
  const unsubRef = useRef(null);

  const handleApiKeyChange = (key) => {
    setGeminiKey(key);
    try { localStorage.setItem("sq_gemini_key", key); } catch { }
  };

  // Subscribe to member's scores from Firebase when logged in
  useEffect(() => {
    if (user?.role === "member") {
      unsubRef.current = fbDb.onMyScores(user.id, setMyScores);
    }
    return () => { if (unsubRef.current) { unsubRef.current(); unsubRef.current = null; } };
  }, [user]);

  const handleLogin = (u) => {
    setUser(u);
  };

  const handleStart = async () => {
    setGenerating(true);
    setAnswers([]);
    try {
      if (geminiKey) {
        const aiQuestions = await generateQuizQuestions(geminiKey);
        setQuestions(aiQuestions);
      } else {
        setQuestions(pick50());
      }
    } catch (err) {
      console.warn("AI generation failed, using hardcoded questions:", err);
      setQuestions(pick50());
    }
    setGenerating(false);
    setView("quiz");
  };

  const handleFinish = async (ans) => {
    setAnswers(ans);
    setView("results");
    if (user?.role === "member") {
      const s = ans.filter(a => a.ok).length, t = questions.length;
      const pct = Math.round(s / t * 100);
      const avgTime = ans.length ? Math.round(ans.reduce((x, a) => x + a.time, 0) / ans.length) : 0;
      const topicScores = {};
      questions.forEach((q, i) => {
        if (!topicScores[q.topic]) topicScores[q.topic] = { ok: 0, total: 0 };
        topicScores[q.topic].total++;
        if (ans[i]?.ok) topicScores[q.topic].ok++;
      });
      // Save to Firebase â€” Admin sees this in real-time!
      await fbDb.pushScore({ id: user.id, name: user.name, score: s, total: t, pct, avgTime, topicScores, date: new Date().toISOString() });
    }
  };

  const handleLogout = () => { setUser(null); setView("home"); setQuestions([]); setAnswers([]); setMyScores([]); setGenerating(false); };

  if (!user) return <LoginScreen onLogin={handleLogin} />;
  if (user.role === "admin") return <AdminDashboard onLogout={handleLogout} />;
  if (view === "quiz" && !generating) return <QuizScreen user={user} questions={questions} onFinish={handleFinish} />;
  if (view === "results") return <ResultsScreen user={user} questions={questions} answers={answers} onRetry={handleStart} onHome={() => setView("home")} />;
  return <MemberHome user={user} onStart={handleStart} onLogout={handleLogout} myScores={myScores} generating={generating} apiKey={geminiKey} onApiKeyChange={handleApiKeyChange} />;
}
